import{a as g,bx as f,r as h,o as b,b as y,h as l,e as u}from"./entry.92cc3846.js";import{E as _}from"./EnsoTable.3d9aed36.js";import{P as v}from"./index.6f6848e2.js";import{L as w}from"./index.44e8f268.js";import{s as D}from"./svg.264bcf91.js";import{c as m,g as d,a as c}from"./personHelper.48677703.js";import"./SearchMode.06b93769.js";import"./focus.3e4288bb.js";import"./VueSelect.b511f2f3.js";import"./EnsoDatepicker.9c00621a.js";import"./selectOnFocus.6b9dd492.js";import"./Modal.987fd8d3.js";import"./text.2058c26f.js";import"./tree.65d50c14.js";import"./vue.runtime.esm-bundler.08aa84eb.js";const k={layout:"auth",meta:{permission:{name:"trees menu"},title:"Trees - Index"},data:()=>({familyData:{},persons:[],selected_person:{},data:{},isLoading:!1,color:"#4fcf8d",backgroundColor:"#ffffff",generation:{label:1,value:1},thumbnail_man:"/images/thumbnail-man.svg",thumbnail_woman:"/images/thumbnail-woman.svg",thumbnail_middle:"/images/thumbnail-unknown.svg"}),components:{EnsoTable:_,Loading:w,vSelect:f},methods:{checkBirthDeathDate(t,e){return e?t?`${t.toString().slice(0,4)}-${e.toString().slice(0,4)}`:"":t?`Born ${t.toString().slice(0,4)}`:""},checkParents(t){const e=[];return this.data.persons[t],console.log("data: ",this.data),Object.values(this.data.unions).filter(o=>{const n=o.children;let r=!1;return n.forEach(a=>{a==t&&(r=!0)}),r}).forEach(o=>{var n;(n=o.partner)==null||n.forEach(r=>{const a=this.data.persons[r];e.push({id:a.id,name:a.name,title:a.titl,firstNames:[m(a)],lastNames:[""],generation:a.generation,sex:a.sex?a.sex:"M",xref:1,birth:d(a),death:c(a),timespan:this.checkBirthDeathDate(a.birthday?a.birthday:a.birth_year,a.deathday?a.deathday:a.death_year),thumbnail:a.sex?a.sex=="F"?this.thumbnail_woman:this.thumbnail_man:thumbnail_middle,parents:this.checkParents(r)})})}),e.length==0?null:e},checkFamilyData(t=null){const e=t?this.data.persons[t]:this.data.persons[this.data.start];return{id:e.id,name:e.name,title:e.titl,firstNames:[m(e)],lastNames:[""],generation:e.generation,sex:e.sex?e.sex:"M",xref:1,birth:d(e),death:c(e),timespan:this.checkBirthDeathDate(e.birthday?e.birthday:e.birth_year,e.deathday?e.deathday:e.death_year),thumbnail:e.sex?e.sex=="F"?this.thumbnail_woman:this.thumbnail_man:this.thumbnail_man,parents:this.checkParents(this.data.start)}},async fetchData(){if(!this.selected_person.value)return;let t={start_id:this.selected_person.value,generation:this.generation.value};this.$axios.$get("/api/trees/show",{params:t}).then(e=>{this.data=e,this.familyData=this.checkFamilyData(),new v("#webtrees-pedigree-chart-container",{labels:{zoom:"Use Ctrl + scroll to zoom in the view",move:"Move the view with two fingers"},generations:1,defaultColor:"#0000FF",fontColor:"#0000FF",showEmptyBoxes:!0,treeLayout:"right",rtl:"rtl"}).draw(this.familyData)})},getPersons(){this.isLoading=!0,this.$axios.$get("/api/persons").then(t=>{this.persons=t.map(e=>{const i=e.birth_year?`${e.name} (${e.birth_year})`:e.birthday?`${e.name} (${new Date(e.birthday).getFullYear()})`:e.name;return{...e,displayname:i}}),this.isLoading=!1})}},mounted(){this.getPersons()},computed:{style(){return D}}},x={class:"select-box"},$=u("div",{style:{height:"700px"},id:"webtrees-pedigree-chart-container"},null,-1);function C(t,e,i,p,o,n){const r=h("loading"),a=h("v-select");return b(),y("div",null,[l(r,{active:t.isLoading,color:t.color,"background-color":t.backgroundColor},null,8,["active","color","background-color"]),u("div",x,[l(a,{style:{width:"100%"},modelValue:t.selected_person,"onUpdate:modelValue":e[0]||(e[0]=s=>t.selected_person=s),options:t.persons.map(s=>s={label:s.displayname,value:s.id}),onInput:n.fetchData},null,8,["modelValue","options","onInput"]),l(a,{style:{width:"100px"},modelValue:t.generation,"onUpdate:modelValue":e[1]||(e[1]=s=>t.generation=s),options:Array.from(Array(10).keys()).map(s=>s={label:s,value:s}),onInput:n.fetchData},null,8,["modelValue","options","onInput"])]),$])}const j=g(k,[["render",C]]);export{j as default};
