import{l as C,Z as U,E as F,q as D,s as T,a as g,V as H,r as u,S as E,o,b as d,e as t,O as k,h as i,t as b,H as v,c as y,I as w,J as O,p as I,L,M as B,z as m,P as N,F as M,x as V,$ as x,a0 as z,a1 as K,a2 as P,a3 as J,a4 as Q,a5 as X,a6 as Z,a7 as Y,a8 as ss,a9 as es,aa as ts,ab as ns,ac as os,ad as is,ae as as,af as rs,w as ls}from"./entry.92cc3846.js";import{_ as ds}from"./EnsoTabs.e092c412.js";import"./Divider.5a44f9ec.js";import{E as j,F as cs}from"./FormFieldGroup.0c63c93a.js";import"./EnsoDatepicker.9c00621a.js";import"./RevealPassword.8886125f.js";import"./VueSelect.b511f2f3.js";import{A as us}from"./Accessories.99347be7.js";import{P as ms}from"./PasswordStrength.379dad38.js";import{D as fs}from"./DeleteModal.5ae30bc1.js";import{U as ps}from"./Url.be2a00eb.js";import{C as R}from"./Confirmation.2ba4c9ec.js";import{M as hs}from"./Modal.987fd8d3.js";import"./focus.3e4288bb.js";import"./SearchMode.06b93769.js";import"./selectOnFocus.6b9dd492.js";C.add([U,F,D,T]);const _s={name:"Token",inject:["canAccess"],directives:{tooltip:H},components:{Confirmation:R},props:{token:{type:Object,required:!0}},data:()=>({confirmation:!1}),methods:{lastUsed({lastUsedAt:s}){return s?`last used: ${this.$formatDistance(s)}`:"Not used yet"}}},$s={class:"box p-1 raises-on-hover mb-2"},vs={class:"level"},ks={class:"level-left"},bs={class:"level-item"},ys={class:"icon is-small m-1"},ws={class:"level-right"},gs={class:"level-item"},Ss={class:"icon is-small"},Cs={class:"is-pulled-right is-flex"},As={class:"button is-naked is-small"},Ts={class:"icon"};function qs(s,e,a,h,S,n){const r=u("fa"),_=u("confirmation"),c=E("tooltip");return o(),d("div",$s,[t("div",vs,[t("div",ks,[t("div",bs,[k((o(),d("span",ys,[i(r,{icon:"key"})])),[[c,a.token.name]]),t("span",null,b(a.token.name),1)])]),t("div",ws,[t("div",gs,[k((o(),d("span",Ss,[i(r,{icon:"calendar-alt"})])),[[c,n.lastUsed(a.token)]]),t("span",Cs,[i(_,{placement:"top",onShow:e[0]||(e[0]=$=>s.confirmation=!0),onHide:e[1]||(e[1]=$=>s.confirmation=!1),onConfirm:e[2]||(e[2]=$=>s.$emit("delete"))},{default:v(()=>[t("a",As,[t("span",Ts,[i(r,{icon:"trash-alt"})])])]),_:1})])])])])])}const Os=g(_s,[["render",qs]]);const Ps={name:"TokenForm",components:{Modal:hs,EnsoForm:j},inject:["i18n"]};function Us(s,e,a,h,S,n){const r=u("enso-form"),_=u("modal");return o(),y(_,w({portal:"token-form"},O(s.$listeners)),{default:v(()=>[i(r,w({class:"box has-background-light"},s.$attrs,{"disable-state":""},O(s.$listeners)),null,16)]),_:1},16)}const Fs=g(Ps,[["render",Us]]);C.add(I,L,B);const Ds={name:"Tokens",inject:["canAccess","errorHandler","i18n","route","toastr"],components:{Token:Os,TokenForm:Fs,Url:ps},props:{id:{type:[Number,String],required:!0}},data:()=>({tokens:[],query:"",form:!1,token:""}),computed:{filtered(){const s=this.query.toLowerCase();return s?this.tokens.filter(({name:e})=>e.toLowerCase().indexOf(s)>-1):this.tokens},count(){return this.filtered.length},create(){return this.route("administration.users.tokens.create",this.$route.params)}},created(){this.fetch()},methods:{fetch(){axios.get(this.route("administration.users.tokens.index",this.$route.params)).then(({data:s})=>{this.tokens=s,this.$emit("update")}).catch(this.errorHandler)},destroy({id:s},e){axios.delete(this.route("administration.users.tokens.destroy",this.$route.params),{params:{id:s}}).then(({data:a})=>{const h=this.tokens.splice(e,1).pop();this.$emit("remove",h.id),this.$emit("update"),this.toastr.success(a.message)}).catch(this.errorHandler)},onCreate({token:s}){this.fetch(),this.form=!1,setTimeout(()=>{this.token=s},500)}}},Hs={class:"tokens-wrapper"},Es={class:"field is-grouped"},Is={class:"control"},Ls={class:"icon"},Bs={class:"control has-icons-left has-icons-right is-expanded"},Ns=["placeholder"],Ms={class:"icon is-small is-left"},Vs=t("a",{class:"delete is-small"},null,-1),js=[Vs],Rs={class:"control"},Ws={class:"icon"};function Gs(s,e,a,h,S,n){const r=u("fa"),_=u("token"),c=u("token-form"),$=u("url");return o(),d("div",Hs,[t("div",Es,[t("p",Is,[n.canAccess("administration.users.tokens.create")?(o(),d("a",{key:0,class:"button is-rounded is-small is-bold is-info",onClick:e[0]||(e[0]=f=>s.form=!0)},[t("span",null,b(n.i18n("New Token")),1),t("span",Ls,[i(r,{icon:"plus"})])])):m("",!0)]),t("p",Bs,[k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=f=>s.query=f),class:"input is-rounded is-small is-expanded",type:"text",placeholder:n.i18n("Filter")},null,8,Ns),[[N,s.query]]),t("span",Ms,[i(r,{icon:"search"})]),s.query?(o(),d("span",{key:0,class:"icon is-small is-right clear-button",onClick:e[2]||(e[2]=f=>s.query="")},js)):m("",!0)]),t("p",Rs,[t("a",{class:"button is-rounded is-small is-bold ml-2",onClick:e[3]||(e[3]=f=>n.fetch())},[t("span",null,b(n.i18n("Reload")),1),t("span",Ws,[i(r,{icon:"sync"})])])])]),t("div",null,[(o(!0),d(M,null,V(n.filtered,(f,A)=>(o(),d("div",{key:f.id},[i(_,{id:a.id,token:f,onDelete:q=>n.destroy(f,A)},null,8,["id","token","onDelete"])]))),128))]),s.form?(o(),y(c,{key:0,path:n.create,onClose:e[4]||(e[4]=f=>s.form=!1),onSubmit:n.onCreate,ref:"form"},null,8,["path","onSubmit"])):m("",!0),i($,{show:s.token!=="",link:s.token,onClose:e[5]||(e[5]=f=>s.token="")},null,8,["show","link"])])}const xs=g(Ds,[["render",Gs]]);C.add([U,F,D,T,x,z,K,P,J,Q,X,Z,Y,ss,es,P,ts,ns,os]);const zs={name:"Session",inject:["canAccess"],directives:{tooltip:H},components:{Confirmation:R},props:{session:{type:Object,required:!0}},data:()=>({confirmation:!1}),methods:{lastActivity({lastActivity:s}){return s?`last used: ${this.$formatDistance(s)}`:"Not used yet"},os({OS:s}){switch(s){case"Windows":case"Windows NT":case"WindowsPhoneOS":case"WindowsMobileOS":return["fab","windows"];case"OS X":case"iOS":case"iPadOS":case"Macintosh":return["fab","apple"];case"Ubuntu":return["fab","ubuntu"];case"OpenBSD":return["fab","freebsd"];case"Debian":case"Linux":return["fab","linux"];case"ChromeOS":return["fab","chrome"];case"AndroidOS":return["fab","android"];default:return"question-circle"}},browser({browser:s}){switch(s){case"Opera Mini":case"Opera":return["fab","opera"];case"Edge":return["fab","edge"];case"Chrome":return["fab","chrome"];case"Mozilla":case"Firefox":return["fab","firefox-browser"];case"Safari":return["fab","safari"];case"IE":return["fab","internet-explorer"];default:return"question-circle"}}}},Ks={class:"box p-1 raises-on-hover mb-2"},Js={class:"level"},Qs={class:"level-left"},Xs={class:"level-item"},Zs={class:"icon is-small m-1"},Ys={class:"level-right"},se={class:"level-item"},ee={class:"icon is-small mr-1"},te={class:"icon is-small mr-1"},ne={class:"icon is-small mr-1"},oe={class:"is-pulled-right is-flex"},ie={class:"button is-naked is-small"},ae={class:"icon"};function re(s,e,a,h,S,n){const r=u("fa"),_=u("confirmation"),c=E("tooltip");return o(),d("div",Ks,[t("div",Js,[t("div",Qs,[t("div",Xs,[k((o(),d("span",Zs,[i(r,{icon:"link"})])),[[c,a.session.ipAddress]]),t("span",null,b(a.session.ipAddress),1)])]),t("div",Ys,[t("div",se,[k((o(),d("span",ee,[i(r,{icon:"calendar-alt"})])),[[c,n.lastActivity(a.session)]]),k((o(),d("span",te,[i(r,{icon:n.os(a.session)},null,8,["icon"])])),[[c,`${a.session.OS} version: ${a.session.OSVersion}`]]),k((o(),d("span",ne,[i(r,{icon:n.browser(a.session)},null,8,["icon"])])),[[c,`${a.session.browser} version: ${a.session.browserVersion}`]]),t("span",oe,[i(_,{placement:"top",onShow:e[0]||(e[0]=$=>s.confirmation=!0),onHide:e[1]||(e[1]=$=>s.confirmation=!1),onConfirm:e[2]||(e[2]=$=>s.$emit("delete"))},{default:v(()=>[t("a",ie,[t("span",ae,[i(r,{icon:"trash-alt"})])])]),_:1})])])])])])}const le=g(zs,[["render",re]]);C.add(I,L,B);const de={name:"Sessions",inject:["canAccess","errorHandler","i18n","route","toastr"],components:{Session:le},props:{id:{type:[Number,String],required:!0}},data:()=>({sessions:[],query:"",form:!1}),computed:{filteredSessions(){const s=this.query.toLowerCase();return s?this.sessions.filter(({ipAddress:e,OS:a,browser:h})=>a.toLowerCase().indexOf(s)>-1||e.toLowerCase().indexOf(s)>-1||h.toLowerCase().indexOf(s)>-1):this.sessions},count(){return this.filteredSessions.length}},created(){this.fetch()},methods:{fetch(){this.$axios.get(this.route("administration.users.sessions.index",this.$route.params)).then(({data:s})=>{this.sessions=s,this.$emit("update")}).catch(this.errorHandler)},destroy({id:s},e){this.$axios.delete(this.route("administration.users.sessions.destroy",this.$route.params),{params:{id:s}}).then(({data:a})=>{const h=this.sessions.splice(e,1).pop();this.$emit("remove",h.id),this.$emit("update"),this.toastr.success(a.message)}).catch(this.errorHandler)}}},ce={class:"sessions-wrapper"},ue={class:"field is-grouped"},me={class:"control has-icons-left has-icons-right is-expanded"},fe=["placeholder"],pe={class:"icon is-small is-left"},he=t("a",{class:"delete is-small"},null,-1),_e=[he],$e={class:"control"},ve={class:"icon"};function ke(s,e,a,h,S,n){const r=u("fa"),_=u("session");return o(),d("div",ce,[t("div",ue,[t("p",me,[k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>s.query=c),class:"input is-rounded is-small is-expanded",type:"text",placeholder:n.i18n("Filter")},null,8,fe),[[N,s.query]]),t("span",pe,[i(r,{icon:"search"})]),s.query?(o(),d("span",{key:0,class:"icon is-small is-right clear-button",onClick:e[1]||(e[1]=c=>s.query="")},_e)):m("",!0)]),t("p",$e,[t("a",{class:"button is-rounded is-small is-bold ml-2",onClick:e[2]||(e[2]=c=>n.fetch())},[t("span",null,b(n.i18n("Reload")),1),t("span",ve,[i(r,{icon:"sync"})])])])]),t("div",null,[(o(!0),d(M,null,V(n.filteredSessions,(c,$)=>(o(),d("div",{key:c.id},[i(_,{id:a.id,session:c,onDelete:f=>n.destroy(c,$)},null,8,["id","session","onDelete"])]))),128))])])}const be=g(de,[["render",ke]]);C.add(is,T,as,rs);const ye={meta:{breadcrumb:"edit",title:"Edit User"},components:{Accessories:us,DeleteModal:fs,EnsoForm:j,FormField:cs,PasswordStrength:ms,Sessions:be,Tab:ds,Tokens:xs},inject:["i18n","canAccess","errorHandler","route","routerErrorHandler","toastr"],data:()=>({deletableUser:null,ready:!1,pivotParams:{userGroups:{id:null}},password:null,passwordConfirmation:null}),computed:{...ls(["enums","user"]),canAccessSessions(){return this.canAccess("administration.users.sessions.index")&&(`${this.user.role.id}`===this.enums.roles.Admin||this.user.id===this.$route.params.user)},canAccessTokens(){return this.canAccess("administration.users.tokens.index")}},methods:{navigateToIndex(){this.deletableUser=null,this.$nextTick(()=>this.$router.push({name:"administration.users.index"}).catch(this.routerErrorHandler))},resetPassword(){axios.post(this.route("administration.users.resetPassword",this.$route.params)).then(({data:s})=>this.toastr.success(s.message)).catch(this.errorHandler)}}},we={class:"columns is-centered"},ge={class:"column is-four-fifths-desktop is-full-touch"},Se={key:0,class:"level-item"},Ce={class:"is-hidden-mobile"},Ae={class:"icon"},Te=t("span",{class:"is-hidden-mobile"},null,-1),qe={class:"level-item"},Oe={class:"is-hidden-mobile"},Pe={class:"icon"},Ue=t("span",{class:"is-hidden-mobile"},null,-1),Fe={key:1,class:"level-item"},De={class:"is-hidden-mobile"},He={class:"icon"},Ee=t("span",{class:"is-hidden-mobile"},null,-1),Ie={class:"columns is-centered"},Le={class:"column is-half"},Be={class:"columns is-centered"},Ne={class:"column is-half"};function Me(s,e,a,h,S,n){const r=u("form-field"),_=u("password-strength"),c=u("fa"),$=u("enso-form"),f=u("tokens"),A=u("tab"),q=u("sessions"),W=u("accessories"),G=u("delete-modal");return o(),d("div",we,[t("div",ge,[i($,{class:"box has-background-light raises-on-hover",ref:"form",path:`api${this.$route.path}`,onReady:e[7]||(e[7]=l=>{s.ready=!0,s.pivotParams.userGroups.id=s.$refs.form.field("group_id").value})},{group_id:v(l=>[i(r,w(l,{onInput:e[0]||(e[0]=p=>s.pivotParams.userGroups.id=p)}),null,16)]),role_id:v(l=>[i(r,w(l,{"pivot-params":s.pivotParams}),null,16,["pivot-params"])]),password:v(l=>[l.field.meta.hidden?m("",!0):(o(),y(r,w({key:0},l,{onFocus:p=>l.field.meta.readonly=!1,onBlur:p=>l.field.meta.readonly=!0,onInput:e[1]||(e[1]=p=>s.password=p.target.value)}),null,16,["onFocus","onBlur"])),i(_,{class:"mt-1",password:l.field.value},null,8,["password"])]),password_confirmation:v(l=>[l.field.meta.hidden?m("",!0):(o(),y(r,w({key:0},l,{onFocus:p=>l.field.meta.readonly=!1,onBlur:p=>l.field.meta.readonly=!0,onInput:e[2]||(e[2]=p=>s.passwordConfirmation=p.target.value),onKeydown:e[3]||(e[3]=p=>{s.$emit("update")})}),null,16,["onFocus","onBlur"]))]),"actions-left":v(()=>[n.canAccess("administration.users.destroy")?(o(),d("div",Se,[s.ready?(o(),d("a",{key:0,class:"button is-danger",onClick:e[4]||(e[4]=l=>s.deletableUser=Number.parseInt(s.$route.params.user,10))},[t("span",Ce,b(n.i18n("Delete")),1),t("span",Ae,[i(c,{icon:"trash-alt"})]),Te])):m("",!0)])):m("",!0),t("div",qe,[s.ready?(o(),d("a",{key:0,class:"button is-warning",onClick:e[5]||(e[5]=l=>s.$router.push({name:"administration.people.edit",params:{person:s.$refs.form.param("personId")}}))},[t("span",Oe,b(n.i18n("Edit Person")),1),t("span",Pe,[i(c,{icon:"user-tie"})]),Ue])):m("",!0)]),n.canAccess("administration.users.resetPassword")?(o(),d("div",Fe,[s.ready?(o(),d("a",{key:0,class:"button is-black",onClick:e[6]||(e[6]=(...l)=>n.resetPassword&&n.resetPassword(...l))},[t("span",De,b(n.i18n("Reset Password")),1),t("span",He,[i(c,{icon:"redo"})]),Ee])):m("",!0)])):m("",!0)]),_:1},8,["path"]),i(W,null,{default:v(({count:l})=>[n.canAccessTokens?(o(),y(A,{key:0,"keep-alive":"",id:"Tokens"},{default:v(()=>[t("div",Ie,[t("div",Le,[i(f,{id:s.$route.params.user,onUpdate:p=>s.$set(l,"Tokens",s.$refs.tokens.count),ref:"tokens"},null,8,["id","onUpdate"])])])]),_:2},1024)):m("",!0),n.canAccessSessions?(o(),y(A,{key:1,"keep-alive":"",id:"Sessions"},{default:v(()=>[t("div",Be,[t("div",Ne,[i(q,{id:s.$route.params.user,onUpdate:p=>s.$set(l,"Sessions",s.$refs.sessions.count),ref:"sessions"},null,8,["id","onUpdate"])])])]),_:2},1024)):m("",!0)]),_:1}),s.deletableUser?(o(),y(G,{key:0,"user-id":s.deletableUser,onClose:e[8]||(e[8]=l=>s.deletableUser=null),onDestroyed:n.navigateToIndex},null,8,["user-id","onDestroyed"])):m("",!0)])])}const nt=g(ye,[["render",Me]]);export{nt as default};
