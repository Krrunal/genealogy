import{_ as I}from"./EnsoTabs.e092c412.js";import{l as A,A as q,B as Q,C as T,D as H,E as N,q as R,s as S,a as y,V,r as a,o as l,b as p,e as s,G as D,t as d,h as i,z as u,c as P,H as h,I as g,J as C,K as M,p as B,L,M as U,N as j,O,P as z,F as G,x as J}from"./entry.92cc3846.js";import{A as K}from"./Accessories.99347be7.js";import{A as W}from"./AddressesCard.a8b3e844.js";import"./Divider.5a44f9ec.js";import{E,F as x}from"./FormFieldGroup.0c63c93a.js";import"./EnsoDatepicker.9c00621a.js";import"./RevealPassword.8886125f.js";import"./VueSelect.b511f2f3.js";import{M as w}from"./Modal.987fd8d3.js";import"./CardRefresh.d37be0b0.js";import"./CardCollapse.4df3c1d4.js";import"./Confirmation.2ba4c9ec.js";import"./focus.3e4288bb.js";import"./SearchMode.06b93769.js";A.add([q,Q,T,H,N,R,S]);const X={name:"Person",inject:["canAccess"],directives:{tooltip:V},props:{person:{type:Object,required:!0}},data:()=>({controls:!1})},Y={class:"title is-5"},Z={key:0,class:"is-pulled-right is-flex"},ee={class:"icon"},se={class:"icon"},te={class:"subtitle is-6"},oe={key:0},ne={key:1};function ie(e,t,r,$,b,o){const c=a("fa");return l(),p("div",{class:"box has-background-light raises-on-hover p-3",onMouseover:t[2]||(t[2]=m=>e.controls=!0),onMouseleave:t[3]||(t[3]=m=>e.controls=!1)},[s("p",Y,[D(d(r.person.name)+" ",1),e.controls?(l(),p("span",Z,[s("a",{class:"button is-naked is-small",onClick:t[0]||(t[0]=m=>e.$emit("edit"))},[s("span",ee,[i(c,{icon:"pencil-alt"})])]),s("a",{class:"button is-naked is-small",onClick:t[1]||(t[1]=m=>e.$emit("delete"))},[s("span",se,[i(c,{icon:"trash-alt"})])])])):u("",!0)]),s("p",te,d(r.person.position),1),r.person.email?(l(),p("p",oe,d(r.person.email),1)):u("",!0),r.person.phone?(l(),p("p",ne,d(r.person.phone),1)):u("",!0)],32)}const ae=y(X,[["render",ie]]);const re={name:"PersonForm",components:{Modal:w,EnsoForm:E},inject:["i18n"],props:{companyId:{type:Number,required:!0}},data:()=>({id:null}),methods:{init({form:e}){this.id=e.field("id").value,e.field("company_id").value=this.companyId}}},le={class:"is-hidden-mobile"},de={class:"icon"},ce=s("span",{class:"is-hidden-mobile"},null,-1);function pe(e,t,r,$,b,o){const c=a("fa"),m=a("enso-form"),_=a("modal");return l(),P(_,g({portal:"person-form"},C(e.$listeners)),{default:h(()=>[i(m,g({class:"box has-background-light"},e.$attrs,{"disable-state":""},C(e.$listeners),{onReady:o.init}),M({_:2},[e.id?{name:"actions-left",fn:h(()=>[s("a",{class:"button is-warning",onClick:t[0]||(t[0]=v=>e.$emit("edit-person",e.id))},[s("span",le,d(o.i18n("Edit Person")),1),s("span",de,[i(c,{icon:"user-tie"})]),ce])]),key:"0"}:void 0]),1040,["onReady"])]),_:1},16)}const me=y(re,[["render",pe]]);A.add(B,L,U);const ue={name:"People",inject:["canAccess","errorHandler","i18n","route","routerErrorHandler","toastr"],components:{Person:ae,PersonForm:me,Modal:w},props:{id:{type:Number,required:!0},query:{type:String,default:""}},data:()=>({loading:!1,people:[],path:null,internalQuery:"",removedPerson:null}),computed:{filteredPeople(){const e=this.internalQuery.toLowerCase();return e?this.people.filter(({name:t,position:r})=>t.toLowerCase().indexOf(e)>-1||r.toLowerCase().indexOf(e)>-1):this.people},count(){return this.filteredPeople.length}},watch:{query(){this.internalQuery=this.query}},created(){this.fetch()},methods:{fetch(){this.loading=!0,this.$axios.get(this.route("administration.companies.people.index",{company:this.id})).then(({data:e})=>{this.people=e,this.$emit("update")}).catch(this.errorHandler).finally(()=>this.loading=!1)},create(){this.path=this.route("administration.companies.people.create",{company:this.id})},edit(e){this.path=this.route("administration.companies.people.edit",{company:this.id,person:e.id})},destroy(){return this.loading=!0,this.$axios.delete(this.route("administration.companies.people.destroy",{company:this.id,person:this.removedPerson.id})).then(()=>{const e=this.people.findIndex(({id:t})=>t===this.removedPerson.id);this.people.splice(e,1),this.$emit("remove",this.removedPerson.id),this.$emit("update")}).catch(this.errorHandler).finally(()=>this.loading=!1)},destroyPerson(){return this.loading=!0,this.$axios.delete(this.route("administration.people.destroy",{person:this.removedPerson.id})).then(({data:{message:e}})=>this.toastr.success(e)).catch(this.errorHandler).finally(()=>{this.loading=!1,this.removedPerson=null})},navigateToPerson(e){this.path=null,this.$nextTick(()=>{this.$router.push({name:"administration.people.edit",params:{person:e}}).catch(this.routerErrorHandler)})}}},he={class:"people-wrapper"},fe={class:"field is-grouped"},_e={class:"control"},ve={class:"icon"},ye={class:"control has-icons-left has-icons-right is-expanded"},$e=["placeholder"],be={class:"icon is-small is-left"},Pe=s("a",{class:"delete is-small"},null,-1),ge=[Pe],ke={class:"control"},Ce={class:"icon"},Ae={class:"columns is-multiline mt-3"},Ee={class:"box"},we={class:"subtitle is-5"},Fe=s("hr",null,null,-1),Ie={class:"level"},qe={class:"level-left"},Qe={class:"level-item"},Te={class:"level-right"},He={class:"level-item"},Ne={class:"level-item"};function Re(e,t,r,$,b,o){const c=a("fa"),m=a("person"),_=a("person-form"),v=a("modal");return l(),p("div",he,[s("div",fe,[j(e.$slots,"controls",{create:o.create,internalQuery:e.internalQuery,fetch:o.fetch},()=>[s("p",_e,[o.canAccess("administration.companies.people.create")?(l(),p("a",{key:0,class:"button is-rounded is-small is-bold is-info",onClick:t[0]||(t[0]=n=>o.create())},[s("span",null,d(o.i18n("Assign")),1),s("span",ve,[i(c,{icon:"plus"})])])):u("",!0)]),s("p",ye,[O(s("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.internalQuery=n),class:"input is-rounded is-small is-expanded",type:"text",placeholder:o.i18n("Filter")},null,8,$e),[[z,e.internalQuery]]),s("span",be,[i(c,{icon:"search"})]),e.internalQuery?(l(),p("span",{key:0,class:"icon is-small is-right clear-button",onClick:t[2]||(t[2]=n=>e.internalQuery="")},ge)):u("",!0)]),s("p",ke,[s("a",{class:"button is-rounded is-small is-bold ml-2",onClick:t[3]||(t[3]=n=>o.fetch())},[s("span",null,d(o.i18n("Reload")),1),s("span",Ce,[i(c,{icon:"sync"})])])])])]),s("div",Ae,[(l(!0),p(G,null,J(o.filteredPeople,(n,k)=>(l(),p("div",{class:"column is-half-tablet",key:n.id},[i(m,{id:r.id,person:n,onEdit:f=>o.edit(n),onDelete:f=>e.removedPerson=n},null,8,["id","person","onEdit","onDelete"])]))),128))]),e.path?(l(),P(_,{key:0,path:e.path,"company-id":r.id,onClose:t[4]||(t[4]=n=>e.path=null),onEditPerson:o.navigateToPerson,onSubmit:t[5]||(t[5]=n=>{o.fetch(),e.path=null}),ref:"form"},null,8,["path","company-id","onEditPerson"])):u("",!0),e.removedPerson?(l(),P(v,{key:1,onClose:t[9]||(t[9]=n=>e.removedPerson=null),class:"remove-person"},{default:h(()=>[s("div",Ee,[s("h5",we,d(o.i18n("What would you like to do?")),1),Fe,s("div",Ie,[s("div",qe,[s("div",Qe,[s("button",{class:"button is-outlined",onClick:t[6]||(t[6]=n=>e.removedPerson=null)},d(o.i18n("Cancel")),1)])]),s("div",Te,[s("div",He,[s("button",{class:"button is-warning ml-1",onClick:t[7]||(t[7]=n=>o.destroy().then(()=>e.removedPerson=null))},d(o.i18n("Remove person from company")),1)]),s("div",Ne,[s("button",{class:"button is-danger ml-1",onClick:t[8]||(t[8]=n=>o.destroy().then(o.destroyPerson))},d(o.i18n("Delete person from application")),1)])])])])]),_:1})):u("",!0)])}const Se=y(ue,[["render",Re]]),Ve={meta:{breadcrumb:"edit",title:"Edit Company"},components:{EnsoForm:E,FormField:x,Accessories:K,Tab:I,Addresses:W,People:Se},computed:{companyId(){return Number.parseInt(this.$route.params.company,10)},pivotParams(){return{companies:{id:this.companyId}}}},methods:{personRemoved(e){this.$refs.form.field("mandatary").value===e&&(this.$refs.form.field("mandatary").value=null)}}},De={class:"columns is-centered"},Me={class:"column is-three-quarters is-full-touch"},Be={class:"columns is-centered"},Le={class:"column is-two-thirds"},Ue={class:"columns is-centered"},je={class:"column is-two-thirds"};function Oe(e,t,r,$,b,o){const c=a("form-field"),m=a("enso-form"),_=a("people"),v=a("tab"),n=a("addresses"),k=a("accessories");return l(),p("div",De,[s("div",Me,[i(m,{class:"box has-background-light raises-on-hover",ref:"form",path:`api${this.$route.path}`},{mandatary:h(f=>[i(c,g(f,{"pivot-params":o.pivotParams}),null,16,["pivot-params"])]),_:1},8,["path"]),i(k,null,{default:h(({count:f})=>[i(v,{"keep-alive":"",id:"People"},{default:h(()=>[s("div",Be,[s("div",Le,[i(_,{id:o.companyId,onUpdate:F=>e.$set(f,"People",e.$refs.people.count),onRemove:o.personRemoved,ref:"people"},null,8,["id","onUpdate","onRemove"])])])]),_:2},1024),i(v,{"keep-alive":"",id:"Addresses"},{default:h(()=>[s("div",Ue,[s("div",je,[i(n,{id:o.companyId,type:"company",onUpdate:F=>e.$set(f,"Addresses",e.$refs.addresses.count),ref:"addresses"},null,8,["id","onUpdate"])])])]),_:2},1024)]),_:1})])])}const as=y(Ve,[["render",Oe]]);export{as as default};
