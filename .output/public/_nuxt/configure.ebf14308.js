import{a as y,o as c,b as d,F as w,x as B,N as m,e as a,O as R,bw as I,G as x,t as u,cK as A,r as h,c as _,H as r,h as k,I as $,n as b,g,z as C,w as D,y as E}from"./entry.92cc3846.js";import{c as M}from"./permission.786d5c94.js";import{a as O,C as S,b as z,d as F}from"./CardRefresh.d37be0b0.js";import{C as T}from"./CardCollapse.4df3c1d4.js";const P="checked",U="unchecked",G="indeterminate",K={name:"CheckboxItems",inject:["i18n"],props:{items:{type:Array,required:!0},modelValue:{type:Array,required:!0}},emits:["change","update:modelValue"],computed:{checked(){return this.items.filter(({id:e})=>this.modelValue.includes(e))},unchecked(){return this.items.filter(({id:e})=>!this.modelValue.includes(e))},selection:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},status(){return this.checked.length===this.items.length?P:this.checked.length?G:U}},watch:{status(){this.$emit("change")}},methods:{all(){this.unchecked.forEach(({id:e})=>this.modelValue.push(e))},change(e){e?this.all():this.none()},none(){this.checked.forEach(e=>this.uncheck(e))},uncheck({id:e}){const t=this.modelValue.indexOf(e);this.modelValue.splice(t,1)}}},L={class:"items"},J={class:"checkbox"},Q=["id","value"];function W(e,t,o,v,V,s){return c(),d("div",L,[(c(!0),d(w,null,B(o.items,n=>(c(),d("div",{class:"is-hoverable-item",key:n.id},[m(e.$slots,"item",{item:n},()=>[a("label",J,[R(a("input",{type:"checkbox",id:n.id,value:n.id,"onUpdate:modelValue":t[0]||(t[0]=i=>s.selection=i)},null,8,Q),[[I,s.selection]]),x(" "+u(n.label),1)])])]))),128))])}const X=y(K,[["render",W]]);const Y={name:"CheckboxManager",components:{Card:O,CardControl:S,CheckboxItems:X,CardHeader:z,CardContent:F,CardCollapse:T},props:{collapsed:{type:Boolean,default:!1},items:{type:Object,required:!0},title:{type:String,required:!0}},emits:["change"],data:()=>({ready:!1,childrenRefs:[]}),computed:{checked(){return(!this.hasItems||this.itemsChecked)&&(!this.hasChildren||this.childrenChecked)},childrenChecked(){return this.ready&&!this.childrenRefs.some(e=>!e.checked)},childrenUnchecked(){return this.ready&&!this.childrenRefs.some(e=>!e.unchecked)},itemsChecked(){return this.ready&&this.$refs.items.status===P},itemsUnchecked(){return this.ready&&this.$refs.items.status===U},hasChildren(){return this.groups.length>0},hasItems(){return this.items._items.length>0},groups(){return Object.keys(this.items).filter(e=>e!=="_items")},unchecked(){return(!this.hasItems||this.itemsUnchecked)&&(!this.hasChildren||this.childrenUnchecked)},checkbox(){return this.$refs.checkbox}},mounted(){this.ready=!0,this.update()},beforeUpdate(){this.childrenRefs=[]},methods:{change(e){e?this.check(!0):this.uncheck(!0)},check(e=!1){this.checkbox.indeterminate=!1,this.checkbox.checked=!0,e&&this.updateBelow()},indeterminate(){this.checkbox.checked=!1,this.checkbox.indeterminate=!0},setChildrenRef(e){e&&this.childrenRefs.push(A(e))},uncheck(e=!1){this.checkbox.checked=!1,this.checkbox.indeterminate=!1,e&&this.updateBelow()},update(){this.checked?this.check():this.unchecked?this.uncheck():this.indeterminate(),this.$emit("change")},updateBelow(){this.hasChildren&&this.childrenRefs.forEach(e=>e.change(this.checkbox.checked)),this.hasItems&&this.$refs.items.change(this.checkbox.checked)}}};function Z(e,t,o,v,V,s){const n=h("card-control"),i=h("card-collapse"),f=h("card-header"),H=h("checkbox-manager",!0),N=h("checkbox-items"),j=h("card-content"),q=h("card");return c(),_(q,{collapsible:"",collapsed:o.collapsed},{default:r(()=>[k(f,{class:"has-background-light"},{title:r(()=>[x(u(o.title),1)]),controls:r(()=>[k(n,null,{default:r(()=>[m(e.$slots,"checkbox",{updateBelow:s.updateBelow},()=>[a("input",{type:"checkbox",onChange:t[0]||(t[0]=(...l)=>s.updateBelow&&s.updateBelow(...l)),ref:"checkbox"},null,544)])]),_:3}),k(i)]),_:3}),k(j,{class:"p-3"},{default:r(()=>[(c(!0),d(w,null,B(s.groups,l=>(c(),_(H,$({class:["is-rounded checkbox-manager",{"raises-on-hover":o.items[l]._items.length}],collapsed:"",title:l,key:l,items:o.items[l]},e.$attrs,{onChange:s.update,ref_for:!0,ref:s.setChildrenRef}),{checkbox:r(p=>[m(e.$slots,"checkbox",b(g(p)))]),item:r(p=>[m(e.$slots,"item",b(g(p)))]),_:2},1040,["class","title","items","onChange"]))),128)),s.hasItems?(c(),_(N,$({key:0,items:o.items._items},e.$attrs,{onChange:s.update,ref:"items"}),{item:r(l=>[m(e.$slots,"item",b(g(l)))]),_:3},16,["items","onChange"])):C("",!0)]),_:3})]),_:3},8,["collapsed"])}const ee=y(Y,[["render",Z]]);const se={meta:{breadcrumb:"configure",title:"Configure Role"},inject:["canAccess","errorHandler","i18n","route","toastr"],components:{CheckboxManager:ee},data:()=>({data:null}),computed:{...D(["enums"])},created(){this.fetch()},methods:{cssClass(e){return M(this.enums.permissionTypes,e)},fetch(){this.$axios.get(this.route("system.roles.permissions.get",this.$route.params.role)).then(({data:e})=>this.data=e).catch(this.errorHandler)},update(){this.$axios.post(this.route("system.roles.permissions.set",this.$route.params.role),{rolePermissions:this.data.rolePermissions}).then(({data:e})=>this.toastr.success(e.message)).catch(this.errorHandler)}}},te={class:"columns is-centered"},ie={class:"column is-half is-three-fifths-desktop is-full-touch"},ae={key:0,class:"animated fadeIn"},ce={class:"level permission is-hoverable p-2 is-mobile"},ne={class:"level-left"},re={class:"level-item"},oe={class:"checkbox"},le=["id","value"],he={class:"level-right"},de={class:"level-item"},ue={key:0,class:"tag is-small is-info is-bold mr-2"},me=["disabled"],ke=a("div",{class:"is-clearfix"},null,-1);function fe(e,t,o,v,V,s){const n=h("checkbox-manager");return c(),d("div",te,[a("div",ie,[e.data?(c(),d("div",ae,[k(n,{class:"is-rounded mt-3",title:`${s.i18n("Permissions")}: ${e.data.role.display_name}`,modelValue:e.data.rolePermissions,"onUpdate:modelValue":t[1]||(t[1]=i=>e.data.rolePermissions=i),items:e.data.permissions},{item:r(({item:i})=>[a("div",ce,[a("div",ne,[a("div",re,[a("label",oe,[R(a("input",{type:"checkbox",id:i.id,value:i.id,"onUpdate:modelValue":t[0]||(t[0]=f=>e.data.rolePermissions=f)},null,8,le),[[I,e.data.rolePermissions]]),x(" "+u(i.description),1)])])]),a("div",he,[a("div",de,[i.isDefault?(c(),d("span",ue,u(s.i18n("Default")),1)):C("",!0),a("span",{class:E(["tag is-small is-bold",s.cssClass(i)])},u(i.type),3)])])])]),_:1},8,["title","modelValue","items"]),a("button",{class:"button is-success mt-3 is-pulled-right",onClick:t[2]||(t[2]=(...i)=>s.update&&s.update(...i)),disabled:!s.canAccess("system.roles.permissions.set")},u(s.i18n("Update")),9,me),ke])):C("",!0)])])}const Ce=y(se,[["render",fe]]);export{Ce as default};
