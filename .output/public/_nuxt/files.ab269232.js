import{a as k,r as l,o as a,c as p,H as _,N as I,n as M,g as T,l as y,di as P,dj as E,dk as q,dl as L,dm as j,dn as V,dp as B,e as s,t as u,h as n,I as N,J as z,dq as O,dr as G,s as K,$ as R,Z as J,ds as W,V as Z,S as Q,b as d,O as U,G as b,aN as $,z as m,M as X,dt as Y,m as ee,w as se,aj as te,aM as oe,x as S,F as A,P as ie,y as D,br as ae}from"./entry.92cc3846.js";import{E as ne,_ as le}from"./EnsoTabs.e092c412.js";import"./EnsoDatepicker.9c00621a.js";import{E as re}from"./EnsoDateFilter.2eb18b56.js";import"./VueSelect.b511f2f3.js";import{_ as ce}from"./InfoPanel.vue.0fb41274.js";import{U as de}from"./Uploader.ba9831ad.js";import{C as ue}from"./Confirmation.2ba4c9ec.js";import{U as fe}from"./Url.be2a00eb.js";import{M as he}from"./Modal.987fd8d3.js";import"./strings.38ce49d3.js";import"./focus.3e4288bb.js";import"./SearchMode.06b93769.js";import"./FileSaver.min.a072bdec.js";import"./CardRefresh.d37be0b0.js";import"./CardCollapse.4df3c1d4.js";import"./selectOnFocus.6b9dd492.js";const me={name:"EnsoUploader",components:{Uploader:de},inject:["http","i18n"],methods:{browseFiles(){this.$refs.uploader.browseFiles()}}};function _e(e,o,i,w,F,t){const r=l("uploader");return a(),p(r,{http:t.http,i18n:t.i18n,ref:"uploader"},{control:_(h=>[I(e.$slots,"control",M(T(h)))]),_:3},8,["http","i18n"])}const pe=k(me,[["render",_e]]),ge=["#008000","#FF0000","#1E90FF","#800080","#FFA500","#A52A2A","#FF4500","#008080","#FF7F50","#6A5ACD","#800000","#708090","#FF1493","#90EE90","#4682B4","#FF00FF","#D2B48C","#C0C0C0","#000000"],ve=["jpg","png","jpeg","gif"],be=["xls","xlsx","csv","numbers"],ke=["doc","docx","pages"],ye=["ppt","pptx","key"],we=["pdf"];y.add(P,E,q,L,j,V);const Fe={computed:{extension(){return this.file.name.split(".").pop().toLowerCase()},isImage(){return ve.includes(this.extension)},isPdf(){return we.includes(this.extension)},isViewable(){return this.isImage||this.isPdf},icon(){return this.isImage?E:this.isPdf?L:be.includes(this.extension)?q:ke.includes(this.extension)?j:ye.includes(this.extension)?V:P}}};y.add(B);const xe={name:"Preview",components:{Modal:he},inject:["i18n","route"],props:{file:{type:Object,required:!0}},computed:{url(){return this.route("core.files.show",this.file.id)}}},Ce={class:"box has-background-light"},Ue={class:"detail"},$e={class:"name"},Se=["href"],Ae={class:"icon"},De=["src"];function Pe(e,o,i,w,F,t){const r=l("fa"),h=l("modal");return a(),p(h,N({class:"preview-modal"},z(e.$listeners)),{default:_(()=>[s("div",Ce,[s("div",Ue,[s("strong",$e,u(i.file.name),1),s("a",{class:"button is-naked",href:t.url,target:"_blank"},[s("span",Ae,[n(r,{icon:"external-link-alt"})])],8,Se)]),s("iframe",{src:t.url},null,8,De)])]),_:1},16)}const Ee=k(xe,[["render",Pe]]);y.add(O,G,K,R,J,W);const qe={name:"File",inject:["canAccess","errorHandler","route"],directives:{tooltip:Z},components:{Confirmation:ue,Url:fe,Preview:Ee},mixins:[Fe],props:{file:{type:Object,required:!0}},data:()=>({preview:null,temporaryLink:""}),computed:{size(){return this.$numberFormat(this.file.size/1e3)}},methods:{link(){this.$axios.get(this.route("core.files.link",this.file.id)).then(({data:e})=>this.temporaryLink=e.link).catch(this.errorHandler)},show(){if(this.file.mimeType==="application/pdf"){this.preview=this.file;return}window.open(this.route("core.files.show",this.file.id),"_blank").focus()},timeFromNow(e){return this.$formatDistance(e)},date(e){return this.$format(e)}}},Le={class:"box has-background-light raises-on-hover file-box p-3"},je={class:"image is-32x32 avatar"},Ve=["src"],He={class:"has-text-centered mb-2"},Ie={class:"title is-5 filename has-text-centered"},Me={class:"has-text-centered"},Te={class:"icon is-small"},Be={class:"mt-1 has-text-centered"},Ne={class:"icon is-small"},ze={class:"has-text-centered mt-2"},Oe={class:"details"},Ge={class:"icon"},Ke={class:"icon"},Re=["href"],Je={class:"icon"},We={class:"button is-naked"},Ze={class:"icon"};function Qe(e,o,i,w,F,t){const r=l("fa"),h=l("confirmation"),g=l("url"),x=l("preview"),v=Q("tooltip");return a(),d("div",Le,[s("figure",je,[s("img",{class:"is-rounded",src:t.route("core.avatars.show",i.file.owner.avatar.id)},null,8,Ve)]),s("p",He,[n(r,{icon:e.icon,size:"3x"},null,8,["icon"])]),U((a(),d("h5",Ie,[b(u(i.file.name),1)])),[[v,i.file.name]]),U((a(),d("p",Me,[s("span",Te,[n(r,{icon:"calendar-alt"})]),b(" "+u(t.timeFromNow(i.file.createdAt)),1)])),[[v,t.date(i.file.createdAt)]]),s("p",Be,[s("span",Ne,[n(r,{icon:"database"})]),b(" "+u(t.size)+" KB ",1)]),s("div",ze,[s("div",Oe,[i.file.isShareable&&t.canAccess("core.files.link")?(a(),d("a",{key:0,class:"button is-naked",onClick:o[0]||(o[0]=$((...f)=>t.link&&t.link(...f),["stop"]))},[s("span",Ge,[n(r,{icon:"link"})])])):m("",!0),i.file.isViewable&&t.canAccess("core.files.show")?(a(),d("a",{key:1,class:"button is-naked",onClick:o[1]||(o[1]=$((...f)=>t.show&&t.show(...f),["stop"]))},[s("span",Ke,[n(r,{icon:"eye"})])])):m("",!0),i.file.isViewable&&t.canAccess("core.files.download")?(a(),d("a",{key:2,class:"button is-naked",href:t.route("core.files.download",i.file.id)},[s("span",Je,[n(r,{icon:"cloud-download-alt"})])],8,Re)):m("",!0),i.file.isDestroyable&&t.canAccess("core.files.destroy")?(a(),p(h,{key:3,placement:"top",onConfirm:o[2]||(o[2]=f=>e.$emit("delete"))},{default:_(()=>[s("a",We,[s("span",Ze,[n(r,{icon:"trash-alt"})])])]),_:1})):m("",!0)])]),n(g,{show:e.temporaryLink!=="",link:e.temporaryLink,onClose:o[3]||(o[3]=f=>e.temporaryLink="")},null,8,["show","link"]),e.preview?(a(),p(x,{key:0,file:e.preview,onClose:o[4]||(o[4]=f=>e.preview=null)},null,8,["file"])):m("",!0)])}const Xe=k(qe,[["render",Qe],["__scopeId","data-v-5303ef66"]]);y.add(X,Y,ee);const Ye={meta:{breadcrumb:"files",title:"Files"},inject:["errorHandler","i18n","route"],components:{EnsoTabs:ne,Tab:le,File:Xe,Chart:ce,EnsoDateFilter:re,EnsoUploader:pe},data:()=>({loading:!1,files:[],folders:[],stats:{},query:null,offset:0,interval:{min:null,max:null}}),computed:{...se("layout",["isMobile"]),...te("preferences",{locale:"lang"}),uploadUrl(){return this.route("core.uploads.store")},colors(){return ge.slice(0,this.folders.length)},foldersStats(){return this.folders.map(e=>this.content(e).reduce((o,{size:i})=>o+=i,0))},chartData(){return{labels:this.folders,datasets:[{data:this.foldersStats,backgroundColor:this.colors,datalabels:{backgroundColor:this.colors,formatter:e=>`${this.$numberFormat(e/1e3)} KB`}}]}},storageUsage(){return this.stats.totalSpaceUsed&&this.$numberFormat(this.stats.totalSpaceUsed*100/this.stats.storageLimit,2)},status(){return this.storageUsage<95?"has-text-success":"has-text-danger"}},watch:{query(){this.reset()}},created(){this.fetch=oe.debounce(this.fetch,300)},methods:{reset(){this.files=[],this.offset=0,this.fetch()},fetch(){this.loading=!0,this.$axios.get(this.route("core.files.index"),{params:{interval:this.interval,query:this.query,offset:this.offset}}).then(({data:e})=>{this.files.push(...e.data),this.offset+=e.data.length,this.folders=e.folders,this.stats=e.stats,this.loading=!1}).catch(this.errorHandler)},destroy(e){this.loading=!0,this.$axios.delete(this.route("core.files.destroy",e,!1)).then(()=>{const o=this.files.findIndex(i=>i.id===e);this.files.splice(o,1),this.loading=!1}).catch(this.errorHandler)},content(e){return this.files.filter(({type:o})=>o===e)},addUploadedFiles(e){this.files.push(...e)},computeScrollPosition(e){const o=e.target.scrollTop,i=e.target.scrollHeight-e.target.clientHeight;o/i>.8&&this.fetch()}}},es={class:"tag is-dark file-counter ml-2"},ss={class:"files-index columns is-reverse-mobile"},ts={class:"column is-two-thirds"},os={class:"column is-one-third"},is={class:"mt-1"},as={class:"control has-icons-left has-icons-right"},ns=["placeholder"],ls={class:"icon is-small is-left"},rs={key:0,class:"icon is-small is-right clear-button"},cs={class:"field is-grouped mt-3"},ds={class:"icon"},us={class:"box has-background-light raises-on-hover"},fs={class:"title is-5 has-text-centered"};function hs(e,o,i,w,F,t){const r=l("file"),h=l("tab"),g=l("fa"),x=l("enso-uploader"),v=l("enso-date-filter"),f=l("chart"),H=l("enso-tabs");return a(),p(H,null,{label:_(({tab:c})=>[s("span",null,u(t.i18n(c)),1),s("span",es,u(t.content(c).length),1)]),default:_(()=>[s("div",ss,[s("div",ts,[(a(!0),d(A,null,S(e.folders,c=>(a(),p(h,{key:c,id:c},{default:_(()=>[n(ae,{class:"columns is-multiline is-mobile folder-content","enter-active-class":"fadeInUp","leave-active-class":"fadeOutDown",tag:"div",onScroll:t.computeScrollPosition},{default:_(()=>[(a(!0),d(A,null,S(t.content(c),C=>(a(),d("div",{class:"column is-half-mobile is-one-third-desktop animated",key:C.id},[n(r,{file:C,onDelete:ms=>t.destroy(C.id)},null,8,["file","onDelete"])]))),128))]),_:2},1032,["onScroll"])]),_:2},1032,["id"]))),128))]),s("div",os,[s("div",is,[s("p",as,[U(s("input",{class:"input is-rounded search-files",placeholder:t.i18n("Filter"),"onUpdate:modelValue":o[0]||(o[0]=c=>e.query=c)},null,8,ns),[[ie,e.query]]),s("span",ls,[n(g,{icon:"search"})]),e.query&&!e.loading?(a(),d("span",rs,[s("a",{class:"delete is-small",onClick:o[1]||(o[1]=c=>e.query=null)})])):m("",!0)])]),s("div",cs,[n(x,{multiple:"",url:t.uploadUrl,"file-key":"upload",onUploadSuccessful:t.addUploadedFiles},null,8,["url","onUploadSuccessful"]),s("a",{class:D(["button is-fullwidth",{"is-loading":e.loading}]),onClick:o[2]||(o[2]=c=>t.fetch())},[s("span",null,u(t.i18n("Load More")),1),s("span",ds,[n(g,{icon:"sync-alt"})])],2)]),n(v,{class:"box raises-on-hover mt-3",value:"today",onUpdate:o[3]||(o[3]=c=>{e.interval=c,t.reset()})}),s("div",us,[s("h5",fs,[b(u(t.i18n("Storage Usage"))+": ",1),s("span",{class:D(t.status)},u(t.storageUsage)+" % ",3)]),!e.isMobile&&e.stats.filteredSpaceUsed>0?(a(),p(f,{key:0,data:t.chartData,options:{aspectRatio:1},type:"doughnut"},null,8,["data"])):m("",!0)])])])]),_:1})}const Es=k(Ye,[["render",hs]]);export{Es as default};
