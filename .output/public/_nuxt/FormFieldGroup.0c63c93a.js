import{a as b,aL as me,r as m,o as i,c as h,R as H,b as c,h as w,O as I,aX as J,I as C,z as v,y as P,P as fe,e as f,aY as z,aZ as he,a_ as ye,a$ as ve,b0 as W,b1 as be,b2 as _e,b3 as ge,b4 as pe,aW as G,V as Fe,aM as Se,S as ke,G as ee,t as O,b5 as te,N as F,F as j,x as S,H as k,K as q,n as V,g as D,aN as we,aj as X,ak as Ce}from"./entry.92cc3846.js";import{E as $e,_ as Oe}from"./EnsoTabs.e092c412.js";import{D as je}from"./Divider.5a44f9ec.js";import{D as Ee}from"./EnsoDatepicker.9c00621a.js";import{l as N,f as Ve,R as De,a as re,b as ne,c as ae,d as Pe,e as Te,g as Be,h as Ue,i as Ae}from"./RevealPassword.8886125f.js";import{V as qe}from"./VueSelect.b511f2f3.js";class Me{constructor(){this.errors={}}all(){return this.errors}any(){return Object.keys(this.errors).length>0}clear(t){this.has(t)&&delete this.errors[t]}empty(){Object.keys(this.errors).forEach(t=>this.clear(t))}first(){const[t=null]=Object.keys(this.errors);return this.get(t)}get(t){return this.has(t)?this.errors[t][0]:null}has(t){return Object.keys(this.errors).includes(t)}set(t){this.errors=t}}const He={name:"CoreForm",provide(){const{create:e,customFields:t,customSections:r,destroy:l,dirty:d,disableState:n,errorCount:o,errorHandler:a,errors:s,fieldBindings:u,fieldType:_,focusError:y,http:$,i18n:T,locale:M,params:L,sectionCustomFields:B,sections:R,show:g,state:p,submit:E,tabbed:x,tabs:de,undo:ue,visibleSection:ce}=this;return{create:e,customFields:t,customSections:r,destroy:l,dirty:d,disableState:n,errorCount:o,errorHandler:a,errors:s,fieldBindings:u,fieldType:_,focusError:y,http:$,i18n:T,locale:M,params:L,sectionCustomFields:B,sections:R,show:g,state:p,submit:E,tabbed:x,tabs:de,undo:ue,visibleSection:ce}},inheritAttrs:!1,props:{disableState:{type:Boolean,default:!1},errorHandler:{type:Function,default:e=>{throw e}},http:{required:!0,type:Function},i18n:{type:Function,default:e=>e},locale:{type:String,default:"en"},params:{type:Object,default:null},path:{type:String,required:!0},routerErrorHandler:{type:Function,default:e=>{throw e}},submitPath:{type:String,default:null},template:{type:Object,default:null}},emits:["create","destroy","error","loaded","ready","show","submitting","submit","submitted","template-fetch-error","undo"],data:()=>({errors:new Me,original:null,state:{loading:!1,data:null}}),computed:{flatten(){return this.state.data&&this.state.data.sections.reduce((e,t)=>e.concat(t.fields),[])},formData(){return this.state.data&&this.flatten.reduce((e,t)=>(this.postable(t)&&(e[t.name]=t.value),e),{})},submitData(){return this.formData&&Object.keys(this.formData).reduce((e,t)=>(t.includes(".")?this.transformNested(e,t):e[t]=this.formData[t],e),{})},getSubmitPath(){return this.submitPath?this.submitPath:this.state.data&&this.state.data.method==="post"?this.state.data.actions.store.path:this.state.data.actions.update.path}},watch:{path:"fetch"},created(){this.init()},methods:{create(){this.$emit("create"),this.$router.push({name:this.state.data.actions.create.route,params:this.state.data.routeParams}).catch(this.routerErrorHandler)},customFields(){return this.state.data.sections.reduce((e,t)=>e.concat(t.fields.filter(r=>r.meta.custom)),[])},customSections(){return this.state.data.sections.filter(({columns:e})=>e==="slot")},dirty(){return this.original&&JSON.stringify(this.formData)!==this.original},dirtyFields(){if(!this.original)return[];const e=JSON.parse(this.original),t=r=>Array.isArray(e[r])?JSON.stringify(e[r])!==JSON.stringify(this.formData[r]):`${e[r]}`!=`${this.formData[r]}`;return Object.keys(e).filter(t)},destroy(){this.modal=!1,this.state.loading=!0,this.http.delete(this.state.data.actions.destroy.path).then(({data:e})=>{this.$emit("destroy",e),e.redirect&&this.$router.push({name:e.redirect,params:this.state.data.routeParams}).catch(this.routerErrorHandler)}).catch(this.errorHandler).finally(()=>this.state.loading=!1)},errorCount(e){return this.sections(e).reduce((t,r)=>(t.push(...r.fields),t),[]).filter(({name:t})=>this.errors.has(t)).length},init(){this.template?(this.state.data=this.template,this.$emit("ready",{form:this})):this.fetch()},fetch(){return this.state.loading=!0,this.http.get(this.path,{params:this.params}).then(({data:e})=>{this.state.data=e.form,this.setOriginal(),this.$emit("ready",{form:this}),this.$emit("loaded",e)}).catch(e=>{this.$emit("template-fetch-error"),this.errorHandler(e)}).finally(()=>this.state.loading=!1)},field(e){return this.flatten.find(t=>t.name===e)},fieldBindings(e){return{errors:this.errors,field:e,i18n:this.i18n,locale:this.locale}},fieldType(e){switch(e.meta.type){case"input":switch(e.meta.content){case"text":case"number":case"email":case"password":case"encrypt":return"input-field";case"checkbox":return"switch-field";case"money":return"money-field";default:throw new Error(`Misconfigured field "${e.name}"`)}case"select":return"select-field";case"textarea":return"textarea-field";case"datepicker":return"date-field";case"timepicker":return"time-field";case"wysiwyg":return"wysiwyg-field";default:throw new Error(`Misconfigured field "${e.name}"`)}},fill(e){Object.keys(e).forEach(t=>this.field(t).value=e[t])},focusError(){const e=this.$parent.$el.querySelector(".help.is-danger");e&&e.scrollIntoView({block:"center"})},param(e){return this.state.data.params[e]},postable(e){return e.meta.content!=="encrypt"||e.value!==e.meta.initialValue},routeParam(e){return this.state.data.routeParams[e]},sectionCustomFields(e){return e.fields.filter(t=>!t.meta.hidden&&t.meta.custom)},sections(e){return this.state.data.sections.filter(t=>t.tab===e)},setOriginal(){this.original=JSON.stringify(this.formData)},show(){const{show:e}=this.state.data.actions;this.$emit("show"),this.$router.push({name:e.route,params:this.state.data.routeParams}).catch(this.routerErrorHandler)},submit(){this.state.loading=!0;const e={...this.submitData,_params:this.params};return this.$emit("submitting"),this.http[this.state.data.method](this.getSubmitPath,e).then(({data:t})=>{this.$emit("submit",t),this.$emit("submitted"),this.setOriginal(),t.reload?this.fetch():t.redirect&&this.$nextTick(()=>this.$router.push({name:t.redirect,params:{...t.param,...this.state.data.routeParams}}).catch(this.routerErrorHandler))}).catch(t=>{this.$emit("error",t);const{status:r,data:l}=t.response;r===422?(this.errors.set(l.errors),this.$nextTick(this.focusError)):this.errorHandler(t)}).finally(()=>this.state.loading=!1)},tabs(){if(!this.state.data.tabs)return[];const e=(t,r)=>(!t.includes(r.tab)&&!r.hidden&&t.push(r.tab),t);return this.state.data.sections.reduce(e,[])},transformNested(e,t){const r=t.split(".");let l=e;do{const d=r.shift();d in l||(l[d]=r.length===0?this.formData[t]:{}),l=l[d]}while(r.length>0)},undo(){this.fill(JSON.parse(this.original)),this.$emit("undo")},hideField(e,t=!0){this.field(e).meta.hidden=!0,t&&this.$forceUpdate()},showField(e,t=!0){this.field(e).meta.hidden=!1,t&&this.$forceUpdate()},hideSection(e,t=!0){e.hidden=!0,t&&this.$forceUpdate()},showSection(e,t=!0){e.hidden=!1,t&&this.$forceUpdate()},visibleSection(e){var t;return!((t=e==null?void 0:e.meta)!=null&&t.hidden)&&this.hasVisibleFields(e)},hasVisibleFields(e){return e.slot||e.fields.some(t=>!t.meta.hidden)},hideTab(e){this.sections(e).forEach(t=>this.hideSection(t,!1)),this.$forceUpdate()},showTab(e){this.sections(e).forEach(t=>this.showSection(t,!1)),this.$forceUpdate()}},render(){return this.$slots.default&&this.$slots.default()}};const Ne={name:"SwitchField",components:{VueSwitch:me},props:{errors:{type:Object,required:!0},field:{type:Object,required:!0}},emits:["changed"]};function Ie(e,t,r,l,d,n){const o=m("vue-switch");return i(),h(o,{class:"is-large is-info",modelValue:r.field.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>r.field.value=a),t[1]||(t[1]=a=>{r.errors.clear(r.field.name),e.$emit("changed")})],disabled:r.field.meta.disabled||r.field.meta.readonly},null,8,["modelValue","disabled"])}const Le=b(Ne,[["render",Ie]]);N.add(Ve);const Re={name:"ErrorIcon",components:{Fa:H}},xe={class:"icon is-small is-right has-text-danger"};function ze(e,t,r,l,d,n){const o=m("fa");return i(),c("span",xe,[w(o,{icon:"exclamation-triangle"})])}const K=b(Re,[["render",ze]]),Ke={name:"InputField",components:{ErrorIcon:K,RevealPassword:De},props:{errors:{type:Object,required:!0},field:{type:Object,required:!0},i18n:{type:Function,required:!0}},emits:["blur","changed","focus"],data:e=>({password:e.field.meta.content==="password"}),computed:{type(){return this.field.meta.content==="encrypt"?"password":this.field.meta.content},reveal(){return this.password&&this.field.value&&this.field.meta.reveal}}},Je=["type"],We=["type"];function Ge(e,t,r,l,d,n){const o=m("reveal-password"),a=m("error-icon");return i(),c("div",{class:P(["control",{"has-icons-right":r.errors.has(r.field.name)||e.password}])},[r.field.meta.content==="number"?I((i(),c("input",C({key:0,class:["input",{"is-danger":r.errors.has(r.field.name)}],"onUpdate:modelValue":t[0]||(t[0]=s=>r.field.value=s)},{...r.field.meta,placeholder:r.i18n(r.field.meta.placeholder)},{type:r.field.meta.content,onFocus:t[1]||(t[1]=s=>e.$emit("focus",s)),onBlur:t[2]||(t[2]=s=>e.$emit("focus",s)),"onUpdate:modelValue":t[3]||(t[3]=s=>{r.errors.clear(r.field.name),e.$emit("changed")})}),null,16,Je)),[[J,r.field.value,void 0,{number:!0}]]):I((i(),c("input",C({key:1,class:["input",{"is-danger":r.errors.has(r.field.name)}],"onUpdate:modelValue":t[4]||(t[4]=s=>r.field.value=s)},{...r.field.meta,placeholder:r.i18n(r.field.meta.placeholder)},{type:n.type,onFocus:t[5]||(t[5]=s=>e.$emit("focus",s)),onBlur:t[6]||(t[6]=s=>e.$emit("focus",s)),"onUpdate:modelValue":t[7]||(t[7]=s=>{r.errors.clear(r.field.name),e.$emit("changed")})}),null,16,We)),[[J,r.field.value]]),n.reveal?(i(),h(o,{key:2,meta:r.field.meta},null,8,["meta"])):v("",!0),r.errors.has(r.field.name)?(i(),h(a,{key:3})):v("",!0)],2)}const Xe=b(Ke,[["render",Ge]]),Ye=Money,Ze={name:"MoneyField",components:{Money:Ye,ErrorIcon:K},props:{errors:{type:Object,required:!0},field:{type:Object,required:!0},i18n:{type:Function,required:!0}},emits:["changed"]};function Qe(e,t,r,l,d,n){const o=m("money"),a=m("error-icon");return i(),c("div",{class:P(["control",{"has-icons-right":r.errors.has(r.field.name)}])},[w(o,C({class:["input",{"is-danger":r.errors.has(r.field.name)}]},{...r.field.meta,placeholder:r.i18n(r.field.meta.placeholder)},{modelValue:r.field.value,"onUpdate:modelValue":[t[0]||(t[0]=s=>r.field.value=s),t[1]||(t[1]=s=>{r.errors.clear(r.field.name),e.$emit("changed")})]}),null,16,["class","modelValue"]),r.errors.has(r.field.name)?(i(),h(a,{key:0})):v("",!0)],2)}const et=b(Ze,[["render",Qe]]),tt={name:"DateField",components:{Datepicker:Ee},props:{errors:{type:Object,required:!0},field:{type:Object,required:!0},i18n:{type:Function,required:!0},locale:{type:String,required:!0},timeOnly:{type:Boolean,default:!1}},emits:["changed"],methods:{clear(){this.$refs.datepicker.clear()}}};function rt(e,t,r,l,d,n){const o=m("datepicker");return i(),h(o,C({...r.field.meta,placeholder:r.i18n(r.field.meta.placeholder)},{modelValue:r.field.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>r.field.value=a),t[1]||(t[1]=a=>{r.errors.clear(r.field.name),e.$emit("changed")})],"alt-input":!!r.field.meta.altFormat,"is-danger":r.errors.has(r.field.name),locale:r.locale,"time-only":r.timeOnly,ref:"datepicker"}),null,16,["modelValue","alt-input","is-danger","locale","time-only"])}const se=b(tt,[["render",rt]]),nt={name:"TimeField",components:{DateField:se}};function at(e,t,r,l,d,n){const o=m("date-field");return i(),h(o,{"time-only":""})}const st=b(nt,[["render",at]]),it={name:"SelectField",components:{VueSelect:qe},inject:["errorHandler"],props:{errors:{type:Object,required:!0},field:{type:Object,required:!0},http:{default:null,type:Function},i18n:{type:Function,required:!0},customParams:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},pivotParams:{type:Object,default:()=>({})}},emits:["changed"],computed:{selection(){return this.$refs.select.selection}},methods:{clear(){this.$refs.select.clear()},fetch(){this.$refs.select.fetch()}}};function ot(e,t,r,l,d,n){const o=m("vue-select");return i(),h(o,C(r.field.meta,{modelValue:r.field.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>r.field.value=a),t[2]||(t[2]=a=>{r.errors.clear(r.field.name),e.$emit("changed")})],"has-error":r.errors.has(r.field.name),http:r.http,i18n:r.i18n,params:r.field.meta.params?r.field.meta.params:r.params,"pivot-params":r.field.meta.pivotParams?r.field.meta.pivotParams:r.pivotParams,"custom-params":r.field.meta.customParams?r.field.meta.customParams:r.customParams,"error-handler":n.errorHandler,onFetch:t[1]||(t[1]=a=>r.field.meta.options=a),ref:"select"}),null,16,["modelValue","has-error","http","i18n","params","pivot-params","custom-params","error-handler"])}const lt=b(it,[["render",ot]]);const dt={name:"TextareaField",components:{ErrorIcon:K},inject:["i18n","errors"],props:{field:{type:Object,required:!0}},emits:["changed"]},ut={class:"control has-icons-right"};function ct(e,t,r,l,d,n){const o=m("error-icon");return i(),c("div",ut,[I(f("textarea",C({class:["textarea",[{"is-danger":n.errors.has(r.field.name)},{fixed:!r.field.meta.resize}]],"onUpdate:modelValue":t[0]||(t[0]=a=>r.field.value=a)},{...r.field.meta,placeholder:n.i18n(r.field.meta.placeholder)},{"onUpdate:modelValue":t[1]||(t[1]=a=>{n.errors.clear(r.field.name),e.$emit("changed")})}),null,16),[[fe,r.field.value]]),n.errors.has(r.field.name)?(i(),h(o,{key:0})):v("",!0)])}const mt=b(dt,[["render",ct],["__scopeId","data-v-b6d5e6a7"]]);var ft=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],ht=function(e){return ft.map(function(t){return t.toLowerCase()}).indexOf(e.toLowerCase())!==-1},yt=function(e,t,r){Object.keys(t).filter(ht).forEach(function(l){var d=t[l];typeof d=="function"&&(l==="onInit"?d(e,r):r.on(l.substring(2),function(n){return d(n,r)}))})},vt=function(e,t,r,l){var d=e.modelEvents?e.modelEvents:null,n=Array.isArray(d)?d.join(" "):d;z(l,function(o,a){r&&typeof o=="string"&&o!==a&&o!==r.getContent({format:e.outputFormat})&&r.setContent(o)}),r.on(n||"change input undo redo",function(){t.emit("update:modelValue",r.getContent({format:e.outputFormat}))})},bt=function(e,t,r,l,d,n){l.setContent(n()),r.attrs["onUpdate:modelValue"]&&vt(t,r,l,d),yt(e,r.attrs,l)},Y=0,ie=function(e){var t=Date.now(),r=Math.floor(Math.random()*1e9);return Y++,e+"_"+r+Y+String(t)},_t=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},Z=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},gt=function(e,t){return Z(e).concat(Z(t))},pt=function(e){return e==null},Q=function(){return{listeners:[],scriptId:ie("tiny-script"),scriptLoaded:!1}},Ft=function(){var e=Q(),t=function(d,n,o,a){var s=n.createElement("script");s.referrerPolicy="origin",s.type="application/javascript",s.id=d,s.src=o;var u=function(){s.removeEventListener("load",u),a()};s.addEventListener("load",u),n.head&&n.head.appendChild(s)},r=function(d,n,o){e.scriptLoaded?o():(e.listeners.push(o),d.getElementById(e.scriptId)||t(e.scriptId,d,n,function(){e.listeners.forEach(function(a){return a()}),e.scriptLoaded=!0}))},l=function(){e=Q()};return{load:r,reinitialize:l}},St=Ft(),kt=function(){return typeof window<"u"?window:global},U=function(){var e=kt();return e&&e.tinymce?e.tinymce:null},wt={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},A=globalThis&&globalThis.__assign||function(){return A=Object.assign||function(e){for(var t,r=1,l=arguments.length;r<l;r++){t=arguments[r];for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&(e[d]=t[d])}return e},A.apply(this,arguments)},Ct=function(e,t,r,l){return e(l||"div",{id:t,ref:r})},$t=function(e,t,r){return e("textarea",{id:t,visibility:"hidden",ref:r})},Ot=he({props:wt,setup:function(e,t){var r=e.init?A({},e.init):{},l=ye(e),d=l.disabled,n=l.modelValue,o=l.tagName,a=ve(null),s=null,u=e.id||ie("tiny-vue"),_=e.init&&e.init.inline||e.inline,y=!!t.attrs["onUpdate:modelValue"],$=!0,T=e.initialValue?e.initialValue:"",M="",L=function(g){return y?function(){return n!=null&&n.value?n.value:""}:function(){return g?T:M}},B=function(){var g=L($),p=A(A({},r),{readonly:e.disabled,selector:"#"+u,plugins:gt(r.plugins,e.plugins),toolbar:e.toolbar||r.toolbar,inline:_,setup:function(E){s=E,E.on("init",function(x){return bt(x,e,t,E,n,g)}),typeof r.setup=="function"&&r.setup(E)}});_t(a.value)&&(a.value.style.visibility=""),U().init(p),$=!1};z(d,function(g){var p;s!==null&&(typeof((p=s.mode)===null||p===void 0?void 0:p.set)=="function"?s.mode.set(g?"readonly":"design"):s.setMode(g?"readonly":"design"))}),z(o,function(g){var p;y||(M=s.getContent()),(p=U())===null||p===void 0||p.remove(s),W(function(){return B()})}),be(function(){if(U()!==null)B();else if(a.value&&a.value.ownerDocument){var g=e.cloudChannel?e.cloudChannel:"5",p=e.apiKey?e.apiKey:"no-api-key",E=pt(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+p+"/tinymce/"+g+"/tinymce.min.js":e.tinymceScriptSrc;St.load(a.value.ownerDocument,E,B)}}),_e(function(){U()!==null&&U().remove(s)}),_||(ge(function(){$||B()}),pe(function(){var g;y||(M=s.getContent()),(g=U())===null||g===void 0||g.remove(s)}));var R=function(g){var p;M=s.getContent(),(p=U())===null||p===void 0||p.remove(s),r=A(A({},r),g),W(function(){return B()})};return t.expose({rerender:R}),function(){return _?Ct(G,u,a,e.tagName):$t(G,u,a)}}});const jt={name:"Wysiwyg",components:{Editor:Ot},inheritAttrs:!1,props:{hasError:{type:Boolean,required:!0},menubar:{type:[String,Boolean],default:!1},plugins:{type:String,default:"codesample autolink link autoresize lists emoticons image preview table"},toolbar:{type:String,default:"newdocument undo redo bold italic strikethrough underline codesample h2 bullist numlist alignleft aligncenter alignright alignjustify blockquote indent outdent link table emoticons forecolor backcolor preview removeformat"}}};function Et(e,t,r,l,d,n){const o=m("editor");return i(),c("div",{class:P(["wysiwyg-wrapper",{"has-error":r.hasError},e.$attrs.class])},[w(o,C(e.$attrs,{toolbar:r.toolbar,plugins:r.plugins,init:{menubar:r.menubar}}),null,16,["toolbar","plugins","init"])],2)}const Vt=b(jt,[["render",Et]]),Dt={name:"WysiwygField",components:{Wysiwyg:Vt},inject:["errors"],props:{field:{type:Object,required:!0}},emits:["changed"]};function Pt(e,t,r,l,d,n){const o=m("wysiwyg");return i(),h(o,C(r.field.meta,{modelValue:r.field.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>r.field.value=a),t[1]||(t[1]=a=>{n.errors.clear(r.field.name),e.$emit("changed")})],"api-key":r.field.meta.apiKey,plugins:r.field.meta.plugins,toolbar:r.field.meta.toolbar,"has-error":n.errors.has(r.field.name)}),null,16,["modelValue","api-key","plugins","toolbar","has-error"])}const Tt=b(Dt,[["render",Pt]]);N.add(re);const Bt={name:"FormField",directives:{tooltip:Fe},components:{Fa:H,DateField:se,InputField:Xe,MoneyField:et,SwitchField:Le,SelectField:lt,TextareaField:mt,TimeField:st,WysiwygField:Tt},inject:["fieldType","errors","http","i18n","locale","state","submit"],inheritAttrs:!1,props:{field:{type:Object,required:!0}},created(){this.autosave=Se.debounce(this.autosave,this.state.data.debounce),!this.state.data.labels&&!this.field.meta.placeholder&&(this.field.meta.placeholder=this.field.label)},methods:{autosave(){this.state.data.autosave&&(this.errors.empty(),this.submit())}}},Ut={key:0,class:"label"},At={key:0,class:"icon is-small has-text-info"},qt={key:1,class:"help is-danger"};function Mt(e,t,r,l,d,n){const o=m("fa"),a=ke("tooltip");return i(),c("div",{class:P(["field",e.$attrs.class])},[n.state.data.labels&&r.field.label?(i(),c("label",Ut,[ee(O(n.i18n(r.field.label))+" ",1),r.field.meta.tooltip?I((i(),c("span",At,[w(o,{icon:"info-circle",size:"xs"})])),[[a,n.i18n(r.field.meta.tooltip)]]):v("",!0)])):v("",!0),(i(),h(te(n.fieldType(r.field)),C(e.$attrs,{field:r.field,errors:n.errors,http:n.http,i18n:n.i18n,locale:n.locale,onChanged:n.autosave,ref:"field"}),null,16,["field","errors","http","i18n","locale","onChanged"])),n.errors.has(r.field.name)?(i(),c("p",qt,O(n.errors.get(r.field.name)),1)):v("",!0),F(e.$slots,"default")],2)}const oe=b(Bt,[["render",Mt]]);const Ht={name:"FormSection",components:{FormField:oe,Divider:je},inject:["state","i18n"],inheritAttrs:!1,props:{section:{type:Object,required:!0}},computed:{columns(){const{columns:e}=this.section;return e==="custom"?this.fields.length:e},fields(){return this.section.fields.filter(({meta:{hidden:e}})=>e!==!0)},rows(){const{columns:e}=this.section;return e==="custom"?1:Math.ceil(this.fields.length/e)}},methods:{cssClass(e,t){const{columns:r}=this.section;return r==="custom"?`is-${this.fields[this.index(e,t)].column}`:null},index(e,t){return(e-1)*this.columns+t-1}}};function Nt(e,t,r,l,d,n){const o=m("divider"),a=m("form-field");return i(),c("div",{class:P(["section-wrapper",e.$attrs.class])},[r.section.divider?(i(),h(o,{key:0,class:"mt-5 mb-5",title:n.i18n(r.section.title),placement:n.state.data.dividerTitlePlacement},null,8,["title","placement"])):v("",!0),(i(!0),c(j,null,S(n.rows,s=>(i(),c("div",{class:"columns mb-3 is-multiline",key:`${r.section.id}-${s}`},[(i(!0),c(j,null,S(n.columns,u=>(i(),c("div",{class:P(["column",n.cssClass(s,u)]),key:n.index(s,u)},[n.index(s,u)<n.fields.length?(i(),c(j,{key:0},[n.fields[n.index(s,u)].meta.custom?F(e.$slots,n.fields[n.index(s,u)].name,{key:0}):(i(),h(a,C({key:1,field:n.fields[n.index(s,u)]},e.$attrs),null,16,["field"]))],64)):v("",!0)],2))),128))]))),128))],2)}const le=b(Ht,[["render",Nt]]),It={name:"FormTabs",components:{Tabs:$e,Tab:Oe,FormSection:le},inject:["errorCount","fieldBindings","sectionCustomFields","i18n","sections","tabs","visibleSection"]},Lt={key:0,class:"tag is-danger is-small error-count"};function Rt(e,t,r,l,d,n){const o=m("form-section"),a=m("tab"),s=m("tabs");return i(),h(s,{class:"form-tabs"},{label:k(({tab:u})=>[ee(O(n.i18n(u))+" ",1),n.errorCount(u)?(i(),c("span",Lt,O(n.errorCount(u)),1)):v("",!0)]),default:k(()=>[(i(!0),c(j,null,S(n.tabs(),u=>(i(),h(a,C({"keep-alive":"",id:u,key:u},e.$attrs),{default:k(()=>[(i(!0),c(j,null,S(n.sections(u),(_,y)=>(i(),c(j,null,[_.columns==="slot"?F(e.$slots,_.slot,{key:0}):n.visibleSection(_)?(i(),h(o,{key:y,section:_},q({_:2},[S(n.sectionCustomFields(_),$=>({name:$.name,fn:k(()=>[F(e.$slots,$.name,V(D(n.fieldBindings($))))])}))]),1032,["section"])):v("",!0)],64))),256))]),_:2},1040,["id"]))),128))]),_:3})}const xt=b(It,[["render",Rt]]);const zt={name:"FormHeader",components:{Fa:H},inject:["state","i18n"]},Kt={key:0,class:"title is-5 form-title"},Jt={key:0,class:"icon"},Wt={key:1};function Gt(e,t,r,l,d,n){const o=m("fa");return n.state.data.icon||n.state.data.title?(i(),c("h5",Kt,[n.state.data.icon?(i(),c("span",Jt,[w(o,{icon:n.state.data.icon},null,8,["icon"])])):v("",!0),n.state.data.title?(i(),c("span",Wt,O(n.i18n(n.state.data.title)),1)):v("",!0)])):v("",!0)}const Xt=b(zt,[["render",Gt]]),Yt={name:"Action",components:{Fa:H},inject:["i18n"],props:{button:{type:Object,required:!0},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},tag:{type:String,required:!0,validator:e=>["a","button"].includes(e)}},emits:["click"],computed:{type(){return this.tag==="button"?"button":null}}},Zt={class:"level-item"},Qt={class:"is-hidden-mobile"},er={class:"icon"},tr=f("span",{class:"is-hidden"},null,-1);function rr(e,t,r,l,d,n){const o=m("fa");return i(),c("div",Zt,[(i(),h(te(r.tag),{type:n.type,class:P(["button",{"is-loading":r.loading},r.button.class]),disabled:r.disabled||null,onClick:t[0]||(t[0]=a=>e.$emit("click"))},{default:k(()=>[f("span",Qt,O(n.i18n(r.button.label)),1),f("span",er,[w(o,{icon:r.button.icon},null,8,["icon"])]),tr]),_:1},8,["type","class","disabled"]))])}const nr=b(Yt,[["render",rr]]);N.add(ne,ae);const ar={name:"Confirmation",components:{Fa:H},inject:["i18n","state"],emits:["cancel","confirm"],computed:{actions(){return this.state.data.actions}}},sr={class:"level mb-0"},ir={class:"level-left"},or={class:"title is-6 animate__animated animate__flash mb-2"},lr={class:"level-left"},dr={class:"level-item"},ur={class:"level is-mobile mb-0"},cr={class:"level-item"},mr={class:"is-hidden-mobile"},fr={class:"icon"},hr=f("span",{class:"is-hidden"},null,-1),yr={class:"level-item"},vr={class:"is-hidden-mobile"},br={class:"icon"},_r=f("span",{class:"is-hidden"},null,-1);function gr(e,t,r,l,d,n){const o=m("fa");return i(),c("div",sr,[f("div",ir,[f("p",or,O(n.i18n(n.actions.destroy.button.message)),1)]),f("div",lr,[f("div",dr,[f("div",ur,[f("div",cr,[f("a",{class:"button is-warning",onClick:t[0]||(t[0]=a=>e.$emit("cancel"))},[f("span",mr,O(n.i18n("Cancel")),1),f("span",fr,[w(o,{icon:"times"})]),hr])]),f("div",yr,[f("a",{class:"button is-danger",onClick:t[1]||(t[1]=a=>e.$emit("confirm"))},[f("span",vr,O(n.i18n(n.actions.destroy.button.label)),1),f("span",br,[w(o,{icon:"check"})]),_r])])])])])])}const pr=b(ar,[["render",gr]]);N.add(Pe,Te,Be,ne,Ue,ae,Ae);const Fr={name:"FormActions",components:{Action:nr,Confirmation:pr,Fa:H},inject:["state","dirty","disableState","errors","undo","i18n","submit","show","create","destroy"],data:()=>({confirmation:!1}),computed:{actions(){return this.state.data.actions}}},Sr={key:1,class:"actions level is-mobile"},kr={class:"level-left"},wr={class:"level-right"},Cr={key:0,class:"level-item"},$r={class:"icon is-small"},Or={key:1,class:"level-item"},jr={class:"icon is-small"};function Er(e,t,r,l,d,n){const o=m("confirmation"),a=m("action"),s=m("fa");return e.confirmation?(i(),h(o,{key:0,onCancel:t[0]||(t[0]=u=>e.confirmation=!1),onConfirm:t[1]||(t[1]=u=>{e.confirmation=!1,n.destroy()})})):(i(),c("div",Sr,[f("div",kr,[n.actions.back?(i(),h(a,{key:0,tag:"a",button:n.actions.back.button,onClick:t[2]||(t[2]=u=>e.$router.go(-1))},null,8,["button"])):v("",!0),n.actions.destroy&&!n.actions.destroy.forbidden?(i(),h(a,{key:1,tag:"a",button:n.actions.destroy.button,onClick:t[3]||(t[3]=u=>e.confirmation=!0)},null,8,["button"])):v("",!0),n.actions.show&&!n.actions.show.forbidden?(i(),h(a,{key:2,tag:"a",button:n.actions.show.button,onClick:t[4]||(t[4]=u=>n.show())},null,8,["button"])):v("",!0),n.actions.create&&!n.actions.create.forbidden?(i(),h(a,{key:3,tag:"a",button:n.actions.create.button,onClick:t[5]||(t[5]=u=>n.create())},null,8,["button"])):v("",!0),F(e.$slots,"actions-left")]),f("div",wr,[n.state.data.clearErrorsControl&&n.errors.any()?(i(),c("div",Cr,[f("a",{class:"button is-small is-bold is-danger",onClick:t[6]||(t[6]=u=>n.errors.empty())},[f("span",null,O(n.i18n("errors")),1),f("span",$r,[w(s,{icon:"times"})])])])):n.dirty()&&!n.disableState?(i(),c("div",Or,[f("a",{class:"button is-small is-bold is-warning",onClick:t[7]||(t[7]=u=>n.undo())},[f("span",null,O(n.i18n("changes")),1),f("span",jr,[w(s,{icon:"undo"})])])])):v("",!0),F(e.$slots,"actions-right"),n.actions.store&&!n.actions.store.forbidden&&!n.state.data.autosave?(i(),h(a,{key:2,tag:"a",button:n.actions.store.button,disabled:n.errors.any(),loading:n.state.loading,onClick:t[8]||(t[8]=u=>n.submit())},null,8,["button","disabled","loading"])):n.actions.update&&!n.actions.update.forbidden&&!n.state.data.autosave?(i(),h(a,{key:3,tag:"a",button:n.actions.update.button,disabled:n.errors.any(),loading:n.state.loading,onClick:t[9]||(t[9]=u=>n.submit())},null,8,["button","disabled","loading"])):v("",!0)])]))}const Vr=b(Fr,[["render",Er]]);const Dr={name:"FormContent",components:{FormHeader:Xt,FormTabs:xt,FormActions:Vr,FormSection:le},inject:["customSections","customFields","fieldBindings","state","sectionCustomFields","visibleSection"]};function Pr(e,t,r,l,d,n){var _;const o=m("form-header"),a=m("form-tabs"),s=m("form-section"),u=m("form-actions");return i(),c(j,null,[w(o),f("form",{class:"is-marginless",onSubmit:t[0]||(t[0]=we(()=>{},["prevent"]))},[(_=n.state.data)!=null&&_.tabs?(i(),h(a,{key:0},q({_:2},[S(n.customFields(),y=>({name:y.name,fn:k(()=>[F(e.$slots,y.name,V(D(n.fieldBindings(y))))])})),S(n.customSections(),y=>({name:y.slot,fn:k(()=>[F(e.$slots,y.slot,{section:y})])}))]),1024)):(i(!0),c(j,{key:1},S(n.state.data.sections,(y,$)=>(i(),c(j,null,[y.columns==="slot"?F(e.$slots,y.slot,{key:0,section:y}):n.visibleSection(y)?(i(),h(s,{key:$,section:y},q({_:2},[S(n.sectionCustomFields(y),T=>({name:T.name,fn:k(()=>[F(e.$slots,T.name,V(D(n.fieldBindings(T))))])}))]),1032,["section"])):v("",!0)],64))),256)),n.state.data.autosave?v("",!0):(i(),h(u,{key:2,class:"mt-3"},q({_:2},[S(["actions-right","actions-left"],y=>({name:y,fn:k(()=>[F(e.$slots,y)])}))]),1024))],32)],64)}const Tr=b(Dr,[["render",Pr]]),Br={name:"VueForm",components:{CoreForm:He,FormContent:Tr,FormField:oe},inheritAttrs:!1,data:()=>({ready:!1}),computed:{customFields(){return this.ready?this.$refs.coreForm.customFields():[]},customSections(){return this.ready?this.$refs.coreForm.customSections():[]},data(){return this.ready?this.$refs.coreForm.state.data:[]},formData(){return this.ready?this.$refs.coreForm.formData:[]},dirty(){return this.ready?this.$refs.coreForm.dirty():!1},dirtyFields(){return this.ready?this.$refs.coreForm.dirtyFields():!1},errors(){return this.ready?this.$refs.coreForm.errors:null}},methods:{fetch(){return this.ready&&this.$refs.coreForm.fetch()},submit(){return this.ready&&this.$refs.coreForm.submit()},field(e){return this.ready&&this.$refs.coreForm.field(e)},param(e){return this.ready&&this.$refs.coreForm.param(e)},routeParam(e){return this.ready&&this.$refs.coreForm.routeParam(e)},fill(e){return this.ready&&this.$refs.coreForm.fill(e)},setOriginal(){return this.ready&&this.$refs.coreForm.setOriginal()},undo(){return this.ready&&this.$refs.coreForm.undo()},hideTab(e){return this.ready&&this.$refs.coreForm.hideTab(e)},showTab(e){return this.ready&&this.$refs.coreForm.showTab(e)},hideField(e){return this.ready&&this.$refs.coreForm.hideField(e)},showField(e){return this.ready&&this.$refs.coreForm.showField(e)}}};function Ur(e,t,r,l,d,n){const o=m("form-field"),a=m("form-content"),s=m("core-form");return i(),c("div",{class:P(["vue-form",e.$attrs.class])},[w(s,C(e.$attrs,{onReady:t[0]||(t[0]=u=>e.ready=!0),ref:"coreForm"}),q({_:2},[e.ready?{name:"default",fn:k(()=>[w(a,null,q({_:2},[S(n.customFields,u=>({name:u.name,fn:k(_=>[F(e.$slots,u.name,V(D(_)),()=>[w(o,V(D(_)),null,16)])])})),S(n.customSections,u=>({name:u.slot,fn:k(_=>[F(e.$slots,u.slot,V(D(_)))])})),S(["actions-right","actions-left"],u=>({name:u,fn:k(()=>[F(e.$slots,u)])}))]),1024)]),key:"0"}:void 0]),1040)],2)}const Ar=b(Br,[["render",Ur]]),qr={name:"EnsoForm",components:{VueForm:Ar},inject:["errorHandler","http","i18n","route","routerErrorHandler","toastr"],props:{disableState:{type:Boolean,default:!1}},data:()=>({ready:!1}),computed:{...X("preferences",["lang","bookmarks"]),...X("bookmarks",["state"]),customFields(){return this.ready?this.$refs.form.customFields:[]},customSections(){return this.ready?this.$refs.form.customSections:[]},data(){return this.ready?this.$refs.form.data:[]},formData(){return this.ready?this.$refs.form.formData:[]},dirty(){return this.ready?this.$refs.form.dirty:!1},dirtyFields(){return this.ready?this.$refs.form.dirtyFields:!1},errors(){return this.ready?this.$refs.form.errors:null},path(){return this.$attrs.path??this.route(this.$route.name,this.$route.params,!1)}},watch:{formData:{handler(e){if(!(this.disableState||!this.bookmarks)){if(!this.dirty){this.updateState({bookmark:this.$route});return}this.updateState({bookmark:this.$route,data:JSON.parse(JSON.stringify(e))})}},deep:!0},dirty(e){!this.disableState&&!e&&this.bookmarks&&this.updateState({bookmark:this.$route})}},methods:{...Ce("bookmarks",["updateState"]),init(){if(this.ready=!0,this.disableState||!this.bookmarks)return;const e=this.state(this.$route);e&&this.fill(e)},fetch(){return this.ready&&this.$refs.form.fetch()},submit(){return this.ready&&this.$refs.form.submit()},field(e){return this.ready&&this.$refs.form.field(e)},param(e){return this.ready&&this.$refs.form.param(e)},routeParam(e){return this.ready&&this.$refs.form.routeParam(e)},fill(e){return this.ready&&this.$refs.form.fill(e)},setOriginal(){return this.ready&&this.$refs.form.setOriginal()},undo(){return this.ready&&this.$refs.form.undo()},hideTab(e){return this.ready&&this.$refs.form.hideTab(e)},showTab(e){return this.ready&&this.$refs.form.showTab(e)},hideField(e){return this.ready&&this.$refs.form.hideField(e)},showField(e){return this.ready&&this.$refs.form.showField(e)},success(e){e.message&&this.toastr.success(e.message)}}};function Mr(e,t,r,l,d,n){const o=m("vue-form");return i(),h(o,{http:n.http,i18n:n.i18n,locale:e.lang,path:n.path,"error-handler":n.errorHandler,"router-error-handler":n.routerErrorHandler,"disable-state":r.disableState,onSubmit:n.success,onDestroy:n.success,onReady:n.init,ref:"form"},q({_:2},[S(n.customFields,a=>({name:a.name,fn:k(s=>[F(e.$slots,a.name,V(D(s)))])})),S(n.customSections,a=>({name:a.slot,fn:k(s=>[F(e.$slots,a.slot,V(D(s)))])})),S(["actions-right","actions-left"],a=>({name:a,fn:k(()=>[F(e.$slots,a)])}))]),1032,["http","i18n","locale","path","error-handler","router-error-handler","disable-state","onSubmit","onDestroy","onReady"])}const zr=b(qr,[["render",Mr]]);N.add(re);export{zr as E,oe as F};
