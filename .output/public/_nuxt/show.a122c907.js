import{h as B,s as c,z as C,t as H,a as S,i as W}from"./text.2058c26f.js";import{t as U}from"./tree.65d50c14.js";import{a as M,bx as z,r as b,o as V,b as Y,h as f,e as E}from"./entry.92cc3846.js";import{L as F}from"./index.44e8f268.js";/* empty css              */import{s as X}from"./svg.264bcf91.js";import{c as w,g as y,a as v}from"./personHelper.48677703.js";import"./vue.runtime.esm-bundler.08aa84eb.js";const L=300,N=80,T=150,I=175,G="down",$="up",P="right",j="left",Z="M",K="F";/**
 * The orientation base class.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class p{constructor(t,e){this._boxWidth=t,this._boxHeight=e,this._splittNames=!1}get splittNames(){return this._splittNames}get boxWidth(){return this._boxWidth}get boxHeight(){return this._boxHeight}direction(){throw"Abstract method direction() not implemented"}nodeWidth(){throw"Abstract method nodeWidth() not implemented"}norm(t){throw"Abstract method norm() not implemented"}elbow(t){throw"Abstract method elbow() not implemented"}}function O(r,t){const e=r.source.x,a=r.source.y+t.direction()*(t.boxHeight/2),i=r.target.x,s=r.target.y-t.direction()*(t.boxHeight/2);return"M "+e+" "+a+" V "+(a+(s-a)/2)+" H "+i+" V "+s}/**
 * This class handles the orientation of the tree.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class q extends p{constructor(t,e){super(t,e),this._splittNames=!0}direction(){return 1}get nodeWidth(){return this._boxWidth*2+30}norm(t){t.y=this.direction()*t.depth*(this._boxHeight+30)}elbow(t){return O(t,this)}}/**
 * This class handles the orientation of the tree.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class J extends p{constructor(t,e){super(t,e),this._splittNames=!0}direction(){return-1}get nodeWidth(){return this._boxWidth*2+30}norm(t){t.y=this.direction()*t.depth*(this._boxHeight+30)}elbow(t){return O(t,this)}}function R(r,t){const e=r.source.x+t.direction()*(t.boxWidth/2),a=r.source.y,i=r.target.x-t.direction()*(t.boxWidth/2),s=r.target.y;return"M "+e+" "+a+" H "+(e+(i-e)/2)+" V "+s+" H "+i}/**
 * This class handles the orientation of the tree.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class _ extends p{constructor(t,e){super(t,e)}direction(){return 1}get nodeWidth(){return this._boxHeight*2+30}norm(t){const e=t.x;t.x=this.direction()*t.depth*(this._boxWidth+30),t.y=e}elbow(t){return R(t,this)}}/**
 * This class handles the orientation of the tree.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class x extends p{constructor(t,e){super(t,e)}direction(){return-1}get nodeWidth(){return this._boxHeight*2+30}norm(t){const e=t.x;t.x=this.direction()*t.depth*(this._boxWidth+30),t.y=e}elbow(t){return R(t,this)}}/**
 * This class handles the orientation of the tree.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class Q{constructor(){this._orientations={[G]:new q(T,I),[$]:new J(T,I),[P]:new _(L,N),[j]:new x(L,N)}}get(){return this._orientations}}/**
 * This class handles the configuration of the application.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class tt{constructor(t,e=4,a=P,i=!1,s=1){this._treeLayout=a,this._orientations=new Q,this.duration=750,this.padding=15,this.imagePadding=5,this._generations=e,this.textPadding=8,this._fontSize=14,this.fontColor="rgb(0, 0, 0)",this.rtl=i,this.labels=t,this.direction=s}get generations(){return this._generations}set generations(t){this._generations=t}get treeLayout(){return this._treeLayout}set treeLayout(t){this._treeLayout=t}get orientation(){return this._orientations.get()[this.treeLayout]}}/**
 * This class handles the hierarchical data.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class et{constructor(t){this._configuration=t,this._nodes=null,this._root=null}init(t){let e=B(t,i=>i.children);const a=U().nodeSize([this._configuration.orientation.nodeWidth,0]).separation(()=>.5);this._root=e,this._nodes=a(e)}get nodes(){return this._nodes}get root(){return this._root}createEmptyNode(t,e){return{id:0,xref:"",url:"",updateUrl:"",generation:t,name:"",firstNames:[],lastNames:[],preferredName:"",alternativeNames:[],isAltRtl:!1,sex:e,timespan:""}}}function it(r,t=null){return fetch(r,t).then(e=>e.blob()).then(e=>new Promise((a,i)=>{const s=new FileReader;s.onloadend=()=>a(s.result),s.onerror=i,s.readAsDataURL(e)}))}/**
 * The person image box container.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */let at=class{constructor(t,e){this._orientation=t,this._cornerRadius=e,this._imagePadding=5,this._imageRadius=Math.min(40,t.boxHeight/2-this._imagePadding),this._x=this.calculateX(),this._y=this.calculateY(),this._width=this.calculateImageWidth(),this._height=this.calculateImageHeight(),this._rx=this.calculateCornerRadius(),this._ry=this.calculateCornerRadius()}calculateX(){return-(this._orientation.boxWidth/2)+this._imagePadding}calculateY(){return this._orientation instanceof _||this._orientation instanceof x?-this._imageRadius:-(this._orientation.boxHeight/2)+this._imagePadding}calculateImageWidth(){return this._orientation instanceof _||this._orientation instanceof x?this._imageRadius*2:this._orientation.boxWidth-this._imagePadding*2}calculateImageHeight(){return this._imageRadius*2}calculateCornerRadius(){return this._cornerRadius-this._imagePadding}get imagePadding(){return this._imagePadding}get imageRadius(){return this._imageRadius}set imageRadius(t){this._imageRadius=t}get x(){return this._x}get y(){return this._y}get rx(){return this._rx}get ry(){return this._ry}get width(){return this._width}get height(){return this._height}};/**
 * The person text box container.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class st{constructor(t,e=null){this._orientation=t,this._image=e,this._textPadding=15,this._x=this.calculateX(),this._y=this.calculateY(),this._width=this.calculateWidth()}calculateX(){const t=-(this._orientation.boxWidth/2)+this._textPadding;return this._image?t+this._image.width:t}calculateY(){return this._orientation instanceof _||this._orientation instanceof x?-this._textPadding:this._image?this._image.y+this._image.height+this._textPadding*2:-(this._orientation.boxHeight/2)+this._textPadding*2}calculateWidth(){const t=this._orientation.boxWidth-this._textPadding*2;return this._image&&(this._orientation instanceof _||this._orientation instanceof x)?t-this._image.width:t}get x(){return this._x}get y(){return this._y}get width(){return this._width}}/**
 * A person box.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class rt{constructor(t){this._cornerRadius=20,this._showImage=!0,this._orientation=t,this._x=-(t.boxWidth/2),this._y=-(t.boxHeight/2),this._rx=this._cornerRadius,this._ry=this._cornerRadius,this._width=t.boxWidth,this._height=t.boxHeight,this._image=new at(t,this._cornerRadius)}get showImage(){return this._showImage}set showImage(t){this._showImage=t}get x(){return this._x}get y(){return this._y}get rx(){return this._rx}get ry(){return this._ry}get width(){return this._width}get height(){return this._height}get image(){return this._image}get text(){return new st(this._orientation,this._showImage?this._image:null)}}/**
 * The class handles the creation of the tree.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class nt{constructor(t,e,a){this._svg=t,this._configuration=e,this._hierarchy=a,this._hierarchy.root.x0=0,this._hierarchy.root.y0=0,this._orientation=this._configuration.orientation,this._box=new rt(this._orientation),this.draw(this._hierarchy.root)}draw(t){let e=this._hierarchy.nodes.descendants(),a=this._hierarchy.nodes.links();e.forEach(i=>{this._orientation.norm(i)}),this.drawLinks(a,t),this.drawNodes(e,t),e.forEach(i=>{i.x0=i.x,i.y0=i.y})}drawNodes(t,e){let a=0,i=this;this._svg.defs.get().append("clipPath").attr("id","clip-image").append("rect").attr("rx",this._box.image.rx).attr("ry",this._box.image.ry).attr("x",this._box.image.x).attr("y",this._box.image.y).attr("width",this._box.image.width).attr("height",this._box.image.height);let n=this._svg.visual.selectAll("g.person").data(t,o=>o.id||(o.id=++a)).enter().append("g").attr("class","person").attr("transform",o=>"translate("+o.x+","+o.y+")");n.append("rect").attr("class",o=>o.data.sex===K?"female":o.data.sex===Z?"male":"unknown").attr("rx",this._box.rx).attr("ry",this._box.ry).attr("x",this._box.x).attr("y",this._box.y).attr("width",this._box.width).attr("height",this._box.height).attr("fill-opacity",.5),n.filter(o=>o.data.xref!=="").each(function(o){let h=c(this);h.append("title").text(d=>d.data.name);const l=i.getImageToLoad(o);if(i._box.showImage=!!l,i._box.showImage){let d=h.append("g").attr("class","image");d.append("rect").attr("rx",i._box.image.rx).attr("ry",i._box.image.ry).attr("x",i._box.image.x).attr("y",i._box.image.y).attr("width",i._box.image.width).attr("height",i._box.image.height).attr("fill","rgb(255, 255, 255)");let g=d.append("image").attr("x",i._box.image.x).attr("y",i._box.image.y).attr("width",i._box.image.width).attr("height",i._box.image.height).attr("clip-path","url(#clip-image)");it(l).then(u=>g.attr("xlink:href",u)).catch(u=>{console.error(u)}),d.append("rect").attr("rx",i._box.image.rx).attr("ry",i._box.image.ry).attr("x",i._box.image.x).attr("y",i._box.image.y).attr("width",i._box.image.width).attr("height",i._box.image.height).attr("fill","none").attr("stroke","rgb(200, 200, 200)").attr("stroke-width",1.5)}i.addNames(h,o),i.addDates(h,o),i._box.showImage=!0})}togglePerson(t,e){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),this.draw(e)}collapse(t){t.children&&(t._children=t.children,t._children.forEach(e=>this.collapse(e)),t.children=null)}addFirstNames(t,e){let a=0;for(let i of e.data.firstNames){let s=t.append("tspan").text(i);i===e.data.preferredName&&s.attr("class","preferred"),a!==0&&s.attr("dx","0.25em"),++a}}addLastNames(t,e,a=0){let i=0;for(let s of e.data.lastNames){let n=t.append("tspan").attr("class","lastName").text(s);i!==0&&n.attr("dx","0.25em"),a!==0&&n.attr("dx",a+"em"),++i}}truncateNames(t){let e=this._box.text.width;t.selectAll("tspan:not(.preferred):not(.lastName)").nodes().reverse().forEach(a=>c(a).each(this.truncateText(t,e))),t.selectAll("tspan.preferred").each(this.truncateText(t,e)),t.selectAll("tspan.lastName").each(this.truncateText(t,e))}truncateText(t,e){let a=this;return function(){let i=a.getTextLength(t),s=c(this),n=s.text().split(/\s+/);for(let o=n.length-1;o>=0;--o)i>e&&(n[o]=n[o].slice(0,1)+".",s.text(n.join(" ")),i=a.getTextLength(t))}}truncateDate(t,e){let a=this;return function(){let i=a.getTextLength(t),s=c(this),n=s.text();for(;i>e&&n.length>1;)n=n.slice(0,-1).trim(),s.text(n),i=a.getTextLength(t);n[n.length-1]==="."&&s.text(n.slice(0,-1).trim())}}getTextLength(t){let e=0;return t.selectAll("tspan").each(function(){e+=this.getComputedTextLength()}),e}addNames(t,e){let a=t.append("g").attr("class","name");if(this._orientation.splittNames){let i=a.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("dy",this._box.text.y),s=a.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("dy",this._box.text.y+20);this.addFirstNames(i,e),this.addLastNames(s,e),!e.data.firstNames.length&&!e.data.lastNames.length&&i.append("tspan").text(e.data.name),this.truncateNames(i),this.truncateNames(s)}else{let i=a.append("text").attr("text-anchor",this._configuration.rtl?"end":"start").attr("dx",this._box.text.x).attr("dy",this._box.text.y);this.addFirstNames(i,e),this.addLastNames(i,e,.25),!e.data.firstNames.length&&!e.data.lastNames.length&&i.append("tspan").text(e.data.name),this.truncateNames(i)}}addDates(t,e){let a=t.append("g").attr("class","table");if(this._orientation.splittNames){let s=a.append("text").attr("class","date").attr("text-anchor","middle").attr("alignment-baseline","central").attr("dy",this._box.text.y+50);s.append("title").text(e.data.timespan);let n=s.append("tspan").text(e.data.timespan);this.getTextLength(s)>this._box.text.width&&(s.selectAll("tspan").each(this.truncateDate(s,this._box.text.width)),n.text(n.text()+"…"));return}let i=20;if(e.data.birth){a.append("text").attr("class","date").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("x",this._box.text.x).attr("dy",this._box.text.y+i).append("tspan").text("★").attr("x",this._box.text.x+5);let n=a.append("text").attr("class","date").attr("text-anchor",this._configuration.rtl?"end":"start").attr("dominant-baseline","middle").attr("x",this._box.text.x).attr("dy",this._box.text.y+i);n.append("title").text(e.data.birth);let o=n.append("tspan").text(e.data.birth).attr("x",this._box.text.x+15);this.getTextLength(n)>this._box.text.width-25&&(n.selectAll("tspan").each(this.truncateDate(n,this._box.text.width-25)),o.text(o.text()+"…"))}if(e.data.death){e.data.birth&&(i+=20),a.append("text").attr("class","date").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("x",this._box.text.x).attr("dy",this._box.text.y+i).append("tspan").text("†").attr("x",this._box.text.x+5);let n=a.append("text").attr("class","date").attr("text-anchor",this._configuration.rtl?"end":"start").attr("dominant-baseline","middle").attr("x",this._box.text.x).attr("dy",this._box.text.y+i);n.append("title").text(e.data.death);let o=n.append("tspan").text(e.data.death).attr("x",this._box.text.x+15);this.getTextLength(n)>this._box.text.width-25&&(n.selectAll("tspan").each(this.truncateDate(n,this._box.text.width-25)),o.text(o.text().trim()+"…"))}}getImageToLoad(t){return t.data.thumbnail?t.data.thumbnail:""}drawLinks(t,e){this._svg.visual.selectAll("path.link").data(t,i=>i.target.id).enter().append("path").classed("link",!0).attr("d",i=>this._orientation.elbow(i))}}/**
 * This class handles the tooltip overlay.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class ot{constructor(t){this._element=t.append("div").attr("class","overlay").style("opacity",1e-6)}show(t,e=0,a=null){this._element.select("p").remove(),this._element.append("p").attr("class","tooltip").text(t),this._element.transition().duration(e).style("opacity",1).on("end",()=>{typeof a=="function"&&a()})}hide(t=0,e=0){this._element.transition().delay(t).duration(e).style("opacity",1e-6)}get(){return this._element}}/**
 * SVG definition class
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class ht{constructor(t){this._element=t.append("defs")}get(){return this._element}}const k=.1,D=20;/**
 * This class handles the zoom.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class lt{constructor(t){this._zoom=null,this._parent=t,this.init()}init(){this._zoom=C(),this._zoom.scaleExtent([k,D]).on("zoom",t=>{this._parent.attr("transform",t.transform)}),this._zoom.wheelDelta(t=>-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)),this._zoom.filter(t=>{if(t.type==="wheel"){if(!t.ctrlKey)return!1;var e=H(this);return e.k&&(e.k<=k&&t.deltaY>0||e.k>=D&&t.deltaY<0)?(t.preventDefault(),!1):!0}return!t.button&&t.type==="touchstart"?t.touches.length===2:(!t.ctrlKey||t.type==="wheel")&&!t.button})}get(){return this._zoom}}/**
 * Base export class.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class A{triggerDownload(t,e){let a=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}),i=document.createElement("a");i.setAttribute("download",e),i.setAttribute("href",t),i.setAttribute("target","_blank"),i.dispatchEvent(a)}}/**
 * Export the chart as PNG image.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class dt extends A{copyStylesInline(t,e){return new Promise(a=>{let i=["svg","g","text","textPath"];for(let s=0;s<e.childNodes.length;++s){let n=e.childNodes[s];if(i.indexOf(n.tagName)!==-1){this.copyStylesInline(t.childNodes[s],n);continue}let o=window.getComputedStyle(t.childNodes[s]);if(o!==null)for(let h=0;h<o.length;++h)n.style.setProperty(o[h],o.getPropertyValue(o[h]))}a(e)})}calculateViewBox(t){const e=t.getBBox(),a=50;return[e.x-a,e.y-a,e.width+a*2,e.height+a*2]}createCanvas(t,e){let a=document.createElement("canvas");return a.width=t,a.height=e,a}convertToDataUrl(t,e,a){return new Promise(i=>{let s=new XMLSerializer().serializeToString(t),n=window.URL||window.webkitURL||window,o=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),h=n.createObjectURL(o),l=new Image;l.onload=()=>{let d=this.createCanvas(e,a),g=d.getContext("2d");g.fillStyle="rgb(255,255,255)",g.fillRect(0,0,d.width,d.height),g.drawImage(l,0,0),n.revokeObjectURL(h);let u=d.toDataURL("image/png").replace("image/png","image/octet-stream");i(u)},l.src=h})}cloneSvg(t){return new Promise(e=>{let a=t.cloneNode(!0);e(a)})}svgToImage(t,e){this.cloneSvg(t.get().node()).then(a=>{this.copyStylesInline(t.get().node(),a);const i=this.calculateViewBox(t.get().node()),s=i[2],n=i[3];a.setAttribute("width",s),a.setAttribute("height",n),a.setAttribute("viewBox",i),this.convertToDataUrl(a,s,n).then(o=>this.triggerDownload(o,e)).catch(()=>{console.log("Failed to save chart as PNG image")})})}}/**
 * Export the chart as raw SVG image.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class ct extends A{copyStylesInline(t,e){return new Promise(a=>{S(t).then(i=>{i=i.replace(/#webtrees-descendants-chart-container /g,"");let s=document.createElementNS("http://www.w3.org/2000/svg","style");s.appendChild(document.createTextNode(i)),e.prepend(s),a(e)})})}convertToObjectUrl(t){return new Promise(e=>{let a=new XMLSerializer().serializeToString(t),i=window.URL||window.webkitURL||window,s=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),n=i.createObjectURL(s),o=new Image;o.onload=()=>{e(n)},o.src=n})}cloneSvg(t){return new Promise(e=>{let a=t.cloneNode(!0);e(a)})}svgToImage(t,e,a){this.cloneSvg(t.get().node()).then(i=>this.copyStylesInline(e,i)).then(i=>this.convertToObjectUrl(i)).then(i=>this.triggerDownload(i,a)).catch(()=>{console.log("Failed to save chart as SVG image")})}}/**
 * The file export factory.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class gt{constructor(){this._exportClass=null}setExportClass(t){switch(t){case"png":this._exportClass=dt;break;case"svg":this._exportClass=ct;break}}createExport(t){switch(this.setExportClass(t),t){case"png":return new this._exportClass;case"svg":return new this._exportClass}}}/**
 * SVG class
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class ut{constructor(t,e){this._element=t.append("svg"),this._defs=new ht(this._element),this._visual=null,this._zoom=null,this._configuration=e,this.init()}init(){this._element.attr("width","100%").attr("height","100%").attr("text-rendering","optimizeLegibility").attr("text-anchor","middle").attr("xmlns:xlink","https://www.w3.org/1999/xlink")}initEvents(t){this._element.on("contextmenu",e=>e.preventDefault()).on("wheel",e=>{e.ctrlKey||t.show(this._configuration.labels.zoom,300,()=>{t.hide(700,800)})}).on("touchend",e=>{e.touches.length<2&&t.hide(0,800)}).on("touchmove",e=>{e.touches.length>=2?t.hide():t.show(this._configuration.labels.move)}).on("click",e=>this.doStopPropagation(e),!0),this._configuration.rtl&&this._element.classed("rtl",!0),this._visual=this._element.append("g"),this._zoom=new lt(this._visual),this._element.call(this._zoom.get())}doStopPropagation(t){t.defaultPrevented&&t.stopPropagation()}export(t){return new gt().createExport(t)}get defs(){return this._defs}get zoom(){return this._zoom}get visual(){return this._visual}get(){return this._element}}const _t=300,m=10;/**
 * This class handles the overall chart creation.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class xt{constructor(t,e){this._configuration=e,this._parent=t,this._hierarchy=new et(this._configuration),this._data={}}get svg(){return this._svg}updateViewBox(){let t=this._svg.visual.node().getBBox(),e=this._parent.node().getBoundingClientRect(),a=Math.max(e.width,t.width),i=Math.max(e.height,t.height,_t),s=(a-t.width)/2,n=(i-t.height)/2,o=Math.ceil(t.x-s-m),h=Math.ceil(t.y-n-m);a=Math.ceil(a+m*2),i=Math.ceil(i+m*2),this._svg.get().attr("viewBox",[o,h,a,i])}get data(){return this._data}set data(t){this._data=t,this._hierarchy.init(this._data)}draw(){this._parent.html(""),this._svg=new ut(this._parent,this._configuration),this._overlay=new ot(this._parent),this._svg.initEvents(this._overlay),new nt(this._svg,this._configuration,this._hierarchy),this.bindClickEventListener(),this.updateViewBox()}bindClickEventListener(){let t=this;this._svg.visual.selectAll("g.person").filter(e=>e.data.xref!=="").each(function(e){c(this).on("click",function(){t.personClick(e.data)})})}personClick(t){t.generation===1?this.redirectToIndividual(t.url):this.update(t.updateUrl)}redirectToIndividual(t){window.location=t}update(t){window.location=t}}/**
 * The application class.
 *
 * @author  Rico Sonntag <mail@ricosonntag.de>
 * @license https://opensource.org/licenses/GPL-3.0 GNU General Public License v3.0
 * @link    https://github.com/magicsunday/webtrees-descendants-chart/
 */class mt{constructor(t,e){this._selector=t,this._parent=c(this._selector),this._configuration=new tt(e.labels,e.generations,e.treeLayout,e.rtl),this._chart=new xt(this._parent,this._configuration),this.init()}init(){c("#centerButton").on("click",()=>this.center()),c("#exportPNG").on("click",()=>this.exportPNG()),c("#exportSVG").on("click",()=>this.exportSVG())}center(){this._chart.svg.get().transition().duration(750).call(this._chart.svg.zoom.get().transform,W)}get configuration(){return this._configuration}set cssFile(t){this._cssFile=t}update(t){this._chart.update(t)}draw(t){this._chart.data=t,this._chart.draw()}exportPNG(){this._chart.svg.export("png").svgToImage(this._chart.svg,"descendants-chart.png")}exportSVG(){this._chart.svg.export("svg").svgToImage(this._chart.svg,this._cssFile,"descendants-chart.svg")}}const pt={layout:"auth",meta:{permission:{name:"decendentchart menu"},title:"DecendentChart - Show"},components:{vSelect:z,Loading:F},data:()=>({familyData:{},persons:[],selected_person:{},data:{},isLoading:!1,color:"#4fcf8d",backgroundColor:"#ffffff",generation:{label:1,value:1},thumbnail_man:"/images/thumbnail-man.svg",thumbnail_woman:"/images/thumbnail-woman.svg",thumbnail_middle:"/images/thumbnail-unknown.svg"}),methods:{getPersons(){this.isLoading=!0,this.$axios.$get("/api/getPersons").then(r=>{this.persons=r.map(t=>{const e=t.birth_year?`${t.name} (${t.birth_year})`:t.birthday?`${t.name} (${new Date(t.birthday).getFullYear()})`:t.name;return{...t,displayname:e}}),this.isLoading=!1})},async fetchData(){if(!this.selected_person.value)return;let r={start_id:this.selected_person.value,generation:this.generation.value};this.$axios.$get("/api/decendent/show",{params:r}).then(t=>{this.data=t,this.familyData=this.checkFamilyData(),new mt("#webtrees-descendants-chart-container",{labels:{zoom:"Use Ctrl + scroll to zoom in the view",move:"Move the view with two fingers"},generations:1,defaultColor:"#0000FF",treeLayout:"down",rtl:"rtl"}).draw(this.familyData)})},checkBirthDeathDate(r,t){return t?r?`${r.toString().slice(0,4)}-${t.toString().slice(0,4)}`:"":r?`Born ${r.toString().slice(0,4)}`:""},checkChildren(r){var a,i;let t=[],e=[];if((a=this.data.persons[r].own_unions)==null||a.forEach(s=>{this.data.unions[s]&&this.data.unions[s].children.forEach(n=>{e.push(n)})}),!!e.length)return(i=this.data.persons[r].own_unions)==null||i.forEach((s,n)=>{var o;if(n>3)return t;(o=this.data.unions[s])==null||o.children.forEach(h=>{let l=this.data.persons[h];t.push({id:l.id,name:l.name,title:l.titl,firstNames:[w(l)],lastNames:[""],generation:l.generation,sex:l.sex?l.sex:"M",xref:1,birth:y(l),death:v(l),timespan:this.checkBirthDeathDate(l.birthday?l.birthday:l.birth_year,l.deathday?l.deathday:l.death_year),thumbnail:l.sex?l.sex=="F"?this.thumbnail_woman:this.thumbnail_man:thumbnail_middle,children:this.checkChildren(h)})})}),t},checkFamilyData(r=null){const t=r?this.data.persons[r]:this.data.persons[this.data.start];return{id:t.id,name:t.name,title:t.titl,firstNames:[w(t)],lastNames:[""],generation:t.generation,sex:t.sex?t.sex:"M",xref:1,birth:y(t),death:v(t),timespan:this.checkBirthDeathDate(t.birthday?t.birthday:t.birth_year,t.deathday?t.deathday:t.death_year),thumbnail:t.sex?t.sex=="F"?this.thumbnail_woman:this.thumbnail_man:thumbnail_middle,children:this.checkChildren(this.data.start)}}},mounted(){this.getPersons()},computed:{style(){return X}}},ft={class:"select-box"},bt=E("div",{style:{height:"700px"},id:"webtrees-descendants-chart-container"},null,-1);function wt(r,t,e,a,i,s){const n=b("loading"),o=b("v-select");return V(),Y("div",null,[f(n,{active:r.isLoading,color:r.color,"background-color":r.backgroundColor},null,8,["active","color","background-color"]),E("div",ft,[f(o,{style:{width:"100%"},modelValue:r.selected_person,"onUpdate:modelValue":t[0]||(t[0]=h=>r.selected_person=h),options:r.persons.map(h=>h={label:h.displayname,value:h.id}),onInput:s.fetchData},null,8,["modelValue","options","onInput"]),f(o,{style:{width:"100px"},modelValue:r.generation,"onUpdate:modelValue":t[1]||(t[1]=h=>r.generation=h),options:Array.from(Array(10).keys()).map(h=>h={label:h,value:h}),onInput:s.fetchData},null,8,["modelValue","options","onInput"])]),bt])}const Pt=M(pt,[["render",wt]]);export{Pt as default};
