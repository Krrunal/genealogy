import{l as j,i as C,a as f,r as i,o as n,c as h,H as u,e as o,h as _,G as L,t as c,b as d,F as k,x as S,I as V,J as U,ah as I,K as O,N as x,z as F,aL as q,w,dx as T,b5 as z,dy as B,s as P,dk as A,f as N,L as H,T as M,y as R}from"./entry.92cc3846.js";import{E as G}from"./EnsoTable.3d9aed36.js";import"./VueSelect.b511f2f3.js";import{E}from"./EnsoSelect.8229d59e.js";import{U as J}from"./Uploader.ba9831ad.js";import{M as K}from"./Modal.987fd8d3.js";import{u as Q}from"./strings.38ce49d3.js";import{D}from"./EnsoDatepicker.9c00621a.js";import"./SearchMode.06b93769.js";import"./focus.3e4288bb.js";import"./selectOnFocus.6b9dd492.js";j.add(C);const W={name:"Summary",components:{Modal:K},inject:["i18n"],props:{summary:{type:Object,required:!0}}},X={class:"box"},Y={class:"title is-4 has-text-centered"},Z={class:"title is-6 has-text-centered is-marginless"},ee={class:"tags is-centered py-3"};function te(e,t,a,y,b,s){const l=i("fa"),m=i("modal");return n(),h(m,V(U(e.$listeners),{portal:"import-summary"}),{default:u(()=>[o("div",X,[o("p",Y,[_(l,{icon:"exclamation-triangle"}),L(" "+c(s.i18n("Structure Errors")),1)]),(n(!0),d(k,null,S(a.summary.errors,(v,p)=>(n(),d("div",{key:p},[o("p",Z,c(p)+": ",1),o("div",ee,[(n(!0),d(k,null,S(v,$=>(n(),d("span",{class:"tag is-medium is-bold has-text-danger",key:$},c($),1))),128))])]))),128))])]),_:1},16)}const ae=f(W,[["render",te]]);j.add(I);const se={name:"ImportUploader",components:{Uploader:J,Summary:ae},inject:["canAccess","i18n","route"],props:{fileSizeLimit:{type:Number,default:100*1e3*1e3},params:{type:Object,required:!0,validator:e=>Object.keys(e).includes("type")},path:{type:String,required:!0}},data:()=>({loading:!1,summary:null}),computed:{hasErrors(){return!!this.summary&&!!this.summary.errors&&Object.keys(this.summary.errors).length>0},templateLink(){return this.canAccess("import.template")&&this.route("import.template",this.params.type)}},methods:{uploaded(e){this.summary=e,this.loading=!1},browseFiles(){this.$refs.uploader.browseFiles()}}},re={class:"is-flex"},oe=["href"],ne={class:"icon is-small"},le={class:"icon is-small"};function ie(e,t,a,y,b,s){const l=i("fa"),m=i("uploader"),v=i("Summary");return n(),d("div",re,[o("a",{class:"button is-info mr-2",href:s.templateLink},[o("span",null,c(s.i18n("Template")),1),o("span",ne,[_(l,{icon:"download"})])],8,oe),_(m,V({url:a.path,params:a.params,"file-size-limit":a.fileSizeLimit,"file-key":"import"},U(e.$listeners),{onUploadStart:t[0]||(t[0]=p=>e.loading=!0),onUploadError:t[1]||(t[1]=p=>e.loading=!1),onUploadSuccessful:s.uploaded,ref:"uploader"}),O({_:2},[s.hasErrors?void 0:{name:"control",fn:u(({controlEvents:p})=>[o("a",V({class:["button is-success",{"is-loading":e.loading}]},U(p,!0)),[x(e.$slots,"default",{},()=>[o("span",null,c(s.i18n("Import")),1),o("span",le,[_(l,{icon:"upload"})])])],16)]),key:"0"}]),1040,["url","params","file-size-limit","onUploadSuccessful"]),s.hasErrors?(n(),h(v,{key:0,summary:e.summary,onClose:t[2]||(t[2]=p=>e.summary=null)},null,8,["summary"])):F("",!0)])}const me=f(se,[["render",ie]]),ce={name:"Checkbox",components:{VueSwitch:q},inject:["i18n"],props:{param:{type:Object,required:!0}}};function de(e,t,a,y,b,s){const l=i("vue-switch");return n(),h(l,{class:"is-medium",modelValue:a.param.value,"onUpdate:modelValue":t[0]||(t[0]=m=>a.param.value=m)},null,8,["modelValue"])}const pe=f(ce,[["render",de]]),ue={name:"Date",components:{Datepicker:D},inject:["i18n"],props:{param:{type:Object,required:!0}},computed:{...w(["meta"]),dateFormat(){var e;return((e=this.param.meta)==null?void 0:e.dateFormat)??this.meta.dateFormat}},created(){this.param.type="date"}};function _e(e,t,a,y,b,s){const l=i("datepicker");return n(),h(l,{modelValue:a.param.value,"onUpdate:modelValue":t[0]||(t[0]=m=>a.param.value=m),"alt-input":"",placeholder:s.i18n(a.param.placeholder),"alt-format":s.dateFormat},null,8,["modelValue","placeholder","alt-format"])}const fe=f(ue,[["render",_e]]),he={name:"Date",components:{Datepicker:D},inject:["i18n"],props:{param:{type:Object,required:!0}},computed:{...w(["meta"]),dateFormat(){var e;return((e=this.param.meta)==null?void 0:e.dateFormat)??this.meta.dateFormat}},created(){this.param.type="date"}};function ye(e,t,a,y,b,s){const l=i("datepicker");return n(),h(l,{modelValue:a.param.value,"onUpdate:modelValue":t[0]||(t[0]=m=>a.param.value=m),"alt-input":"",placeholder:s.i18n(a.param.placeholder),"alt-format":s.dateFormat},null,8,["modelValue","placeholder","alt-format"])}const be=f(he,[["render",ye]]),ve={name:"Select",components:{EnsoSelect:E},inject:["i18n"],props:{param:{type:Object,required:!0}},computed:{placeholder(){return this.param.placeholder?this.i18n(this.param.placeholder):this.param.placeholder}}};function $e(e,t,a,y,b,s){const l=i("enso-select");return n(),h(l,{modelValue:a.param.value,"onUpdate:modelValue":t[0]||(t[0]=m=>a.param.value=m),source:a.param.route,label:a.param.selectLabel,placeholder:s.placeholder,multiple:a.param.multiple,params:a.param.params},null,8,["modelValue","source","label","placeholder","multiple","params"])}const ge=f(ve,[["render",$e]]);j.add(T);const ke={name:"Param",components:{Checkbox:pe,Input:fe,Date:be,Select:ge},inject:["i18n"],props:{param:{type:Object,required:!0}},computed:{component(){return Q(this.param.type)}}},je={class:"field is-horizontal"},Se={key:0,class:"field-label is-normal"},Ve={class:"label"},Ue={class:"field-body"},Fe={class:"field"};function we(e,t,a,y,b,s){return n(),d("div",je,[a.param.label?(n(),d("div",Se,[o("label",Ve,c(s.i18n(a.param.label)),1)])):F("",!0),o("div",Ue,[o("div",Fe,[(n(),h(z(s.component),{param:a.param},null,8,["param"]))])])])}const xe=f(ke,[["render",we]]);j.add(B,P,A,N,H);const Ee={meta:{breadcrumb:"data import",title:"Data Import"},inject:["canAccess","errorHandler","i18n","route"],components:{Avatar:M,EnsoSelect:E,EnsoTable:G,ImportUploader:me,Param:xe},data:()=>({type:null,params:[]}),computed:{...w(["enums"]),filters(){return{data_imports:{type:this.type}}},importLink(){return this.canAccess("import.store")&&this.type&&this.route("import.store")},uploadParams(){return this.params.reduce((e,t)=>(e[t.name]=t.value,e),{type:this.type})}},methods:{template(){this.$axios.get(this.route("import.show",this.type)).then(({data:{params:e}})=>this.params=e).catch(this.errorHandler)},rejected({rejected_id:e}){window.location.href=this.route("import.rejected",e)}}},De={class:"wrapper"},Ce={class:"columns is-variable is-2 is-mobile is-multiline"},Le={class:"column is-3-desktop is-half-touch"},Ie=o("div",{class:"column"},null,-1),Oe={class:"column is-narrow"},qe={class:"tag is-table-tag is-info"},Te={class:"has-text-info"},ze={class:"has-text-success"},Be={class:"has-text-danger"};function Pe(e,t,a,y,b,s){const l=i("enso-select"),m=i("Param"),v=i("import-uploader"),p=i("avatar"),$=i("enso-table");return n(),d("div",De,[o("div",Ce,[o("div",Le,[_(l,{modelValue:e.type,"onUpdate:modelValue":t[0]||(t[0]=r=>e.type=r),options:e.enums.importTypes._select(),placeholder:"Import Type",onInput:t[1]||(t[1]=r=>e.type?s.template():null)},null,8,["modelValue","options"])]),e.type?(n(),d(k,{key:0},[(n(!0),d(k,null,S(e.params,r=>(n(),d("div",{class:"column is-3-desktop is-half-touch",key:r.name},[r.type==="slot"?x(e.$slots,r.name,{key:0}):(n(),h(m,{key:1,param:r},null,8,["param"]))]))),128)),Ie,o("div",Oe,[_(v,{path:s.importLink,params:s.uploadParams,onUploadSuccessful:t[2]||(t[2]=r=>e.$refs.imports.fetch())},null,8,["path","params"])])],64)):F("",!0)]),_($,{class:"box is-paddingless raises-on-hover",id:"dataImports",filters:s.filters,onDownloadRejected:s.rejected,ref:"imports"},{type:u(({column:r,row:g})=>[o("span",qe,c(r.enum._get(g.type)),1)]),entries:u(({row:r})=>[o("strong",Te,c(r.entries||"-"),1)]),successful:u(({row:r})=>[o("strong",ze,c(r.successful===null?"-":r.successful),1)]),failed:u(({row:r})=>[o("strong",Be,c(r.failed===null?"-":r.failed),1)]),status:u(({column:r,row:g})=>[o("span",{class:R(["tag is-table-tag",e.enums.importCssClasses._get(g.status)])},c(r.enum._get(g.status)),3)]),createdBy:u(({row:r})=>[_(p,{class:"is-24x24",user:r.createdBy},null,8,["user"])]),_:1},8,["filters","onDownloadRejected"])])}const Ye=f(Ee,[["render",Pe]]);export{Ye as default};
